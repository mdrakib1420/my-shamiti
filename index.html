<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>рж╕ржорж┐рждрж┐ ржорзНржпрж╛ржирзЗржЬрж╛рж░</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0f1923;font-family:'Hind Siliguri',sans-serif;}
input,select,textarea,button{font-family:'Hind Siliguri',sans-serif;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:rgba(255,255,255,0.05);}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2);border-radius:2px;}
</style>
</head>
<body>
<div id="root"></div>
<!-- Firebase SDK via CDN (compat version - window ржП ржХрж╛ржЬ ржХрж░рзЗ) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAAuQ-VvZXyLL7CWphLmgztMAKzSXVTms8",
    authDomain: "my-shamiti.firebaseapp.com",
    projectId: "my-shamiti",
    storageBucket: "my-shamiti.firebasestorage.app",
    messagingSenderId: "698652279640",
    appId: "1:698652279640:web:69e3219c495fcab80f5b2d"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== Firebase Helper Functions =====

  window.fbGetSuper = async () => {
    try {
      const snap = await db.collection("super").doc("main").get();
      if (snap.exists) return snap.data().value ? JSON.parse(snap.data().value) : null;
      return null;
    } catch(e) { console.error("fbGetSuper error:", e); return null; }
  };

  window.fbSaveSuper = async (data) => {
    try {
      await db.collection("super").doc("main").set({ value: JSON.stringify(data) });
    } catch(e) { console.error("fbSaveSuper error:", e); }
  };

  window.fbGetSamiti = async (id) => {
    try {
      const snap = await db.collection("samitis").doc(id).get();
      if (snap.exists) return snap.data().value ? JSON.parse(snap.data().value) : null;
      return null;
    } catch(e) { console.error("fbGetSamiti error:", e); return null; }
  };

  window.fbSaveSamiti = async (id, data) => {
    try {
      await db.collection("samitis").doc(id).set({ value: JSON.stringify(data) });
    } catch(e) { console.error("fbSaveSamiti error:", e); }
  };

  window.firebaseReady = true;
  console.log("тЬЕ Firebase ready!");
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useRef } = React;


const LOAN_PACKAGES=[5000,10000,15000,20000,25000,30000,40000,50000,60000,70000,80000,100000];
const KISTI_TYPES=["ржжрзИржирж┐ржХ","рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ","ржорж╛рж╕рж┐ржХ"];
const EMPTY={users:[{id:'admin1',role:'admin',name:'ржЕрзНржпрж╛ржбржорж┐ржи',phone:'01700000000',password:'admin123',photo:null}],matkormi:[],grahok:[],payments:[],loans:[],dps:[],messages:[],announcement:{text:'',active:false},settings:{dpsNumber:'',dpsApp:'ржмрж┐ржХрж╛рж╢',dpsMethod:'sendMoney',dpsMerchantNumber:'',whatsappNumber:'',whatsappLink:''}};
function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2);}
function getSav(gid,d){return d.payments.filter(p=>p.grahokId===gid&&p.status==='approved'&&p.type!=='loan').reduce((s,p)=>s+p.amount,0);}
function getLoan(gid,d){return d.loans.filter(l=>l.grahokId===gid&&l.status==='approved').reduce((s,l)=>s+l.amount,0);}
function getUnread(uid,role,msgs){return msgs.filter(m=>(m.to===role||m.to===uid)&&!(m.readBy||[]).includes(uid)).length;}
function downloadCSV(filename,rows,headers){const csv=[headers.join(','),...rows.map(r=>r.map(c=>'"'+String(c||'').replace(/"/g,'""')+'"').join(','))].join('\n');const blob=new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);}

function LiveClock(){const[t,setT]=useState(new Date());useEffect(()=>{const i=setInterval(()=>setT(new Date()),1000);return()=>clearInterval(i);},[]);const D=["рж░ржмрж┐ржмрж╛рж░","рж╕рзЛржоржмрж╛рж░","ржоржЩрзНржЧрж▓ржмрж╛рж░","ржмрзБржзржмрж╛рж░","ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░","рж╢рзБржХрзНрж░ржмрж╛рж░","рж╢ржирж┐ржмрж╛рж░"];const M=["ржЬрж╛ржирзБржпрж╝рж╛рж░рж┐","ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐","ржорж╛рж░рзНржЪ","ржПржкрзНрж░рж┐рж▓","ржорзЗ","ржЬрзБржи","ржЬрзБрж▓рж╛ржЗ","ржЖржЧрж╕рзНржЯ","рж╕рзЗржкрзНржЯрзЗржорзНржмрж░","ржЕржХрзНржЯрзЛржмрж░","ржиржнрзЗржорзНржмрж░","ржбрж┐рж╕рзЗржорзНржмрж░"];const p=n=>String(n).padStart(2,'0');const h=t.getHours(),m=t.getMinutes(),s=t.getSeconds(),ap=h>=12?'PM':'AM',hh=h%12||12;return(<div style={{textAlign:'center'}}><div style={{fontSize:'12px',color:'#a0aec0'}}>{D[t.getDay()]}, {t.getDate()} {M[t.getMonth()]} {t.getFullYear()}</div><div style={{fontSize:'19px',fontWeight:'700',color:'#fff',fontFamily:'monospace',letterSpacing:'2px'}}>{p(hh)}:{p(m)}:{p(s)} {ap}</div></div>);}
function Av({photo,name,size=48}){const cc=['#667eea','#f093fb','#4facfe','#43e97b','#fa709a','#fee140','#30cfd0','#a18cd1'];const c=cc[((name||'A').charCodeAt(0))%cc.length];if(photo)return <img src={photo} alt={name} style={{width:size,height:size,borderRadius:'50%',objectFit:'cover',border:'2px solid rgba(255,255,255,0.3)',flexShrink:0}}/>;return <div style={{width:size,height:size,borderRadius:'50%',background:c,display:'flex',alignItems:'center',justifyContent:'center',fontSize:size*0.4,fontWeight:'700',color:'#fff',border:'2px solid rgba(255,255,255,0.3)',flexShrink:0}}>{(name||'A')[0].toUpperCase()}</div>;}
function Md({title,onClose,children}){return(<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.75)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000,padding:'16px'}}><div style={{background:'#1a2332',borderRadius:'16px',padding:'22px',width:'100%',maxWidth:'480px',maxHeight:'90vh',overflowY:'auto',border:'1px solid rgba(255,255,255,0.1)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'18px'}}><h3 style={{color:'#fff',fontSize:'17px',fontWeight:'700',margin:0}}>{title}</h3><button onClick={onClose} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'5px 10px',cursor:'pointer'}}>x</button></div>{children}</div></div>);}
function Inp({label,...p}){return(<div style={{marginBottom:'12px'}}>{label&&<label style={{display:'block',color:'#a0aec0',fontSize:'13px',marginBottom:'5px',fontWeight:'500'}}>{label}</label>}<input {...p} style={{width:'100%',background:'rgba(255,255,255,0.07)',border:'1px solid rgba(255,255,255,0.15)',borderRadius:'10px',padding:'10px 14px',color:'#fff',fontSize:'14px',outline:'none',boxSizing:'border-box',...p.style}}/></div>);}
function Slct({label,children,...p}){return(<div style={{marginBottom:'12px'}}>{label&&<label style={{display:'block',color:'#a0aec0',fontSize:'13px',marginBottom:'5px',fontWeight:'500'}}>{label}</label>}<select {...p} style={{width:'100%',background:'#1e2d3d',border:'1px solid rgba(255,255,255,0.15)',borderRadius:'10px',padding:'10px 14px',color:'#fff',fontSize:'14px',outline:'none',boxSizing:'border-box'}}>{children}</select></div>);}
function Btn({ch,onClick,color='#4f8ef7',outline,sm,full,dis,sx}){return(<button onClick={onClick} disabled={dis} style={{background:outline?'transparent':color,border:outline?'1px solid '+color:'none',color:outline?color:'#fff',borderRadius:'10px',padding:sm?'7px 13px':'10px 18px',fontSize:sm?'13px':'14px',fontWeight:'600',cursor:dis?'not-allowed':'pointer',width:full?'100%':'auto',opacity:dis?0.5:1,transition:'all 0.2s',fontFamily:"'Hind Siliguri',sans-serif",...sx}}>{ch}</button>);}
function Crd({children,sx,onClick}){return <div onClick={onClick} style={{background:'rgba(255,255,255,0.05)',borderRadius:'14px',padding:'15px',border:'1px solid rgba(255,255,255,0.08)',cursor:onClick?'pointer':'default',...sx}}>{children}</div>;}
function Stat({label,value,icon,color}){return(<Crd sx={{textAlign:'center'}}><div style={{fontSize:'24px',marginBottom:'6px'}}>{icon}</div><div style={{fontSize:'21px',fontWeight:'800',color:color||'#4f8ef7'}}>{value}</div><div style={{fontSize:'11px',color:'#718096',marginTop:'3px'}}>{label}</div></Crd>);}
function PhotoPick({value,onChange,size=80}){const r=useRef();const h=e=>{const f=e.target.files[0];if(!f)return;const rd=new FileReader();rd.onload=ev=>onChange(ev.target.result);rd.readAsDataURL(f);};return(<div style={{display:'flex',flexDirection:'column',alignItems:'center',marginBottom:'14px',gap:'8px'}}><div onClick={()=>r.current.click()} style={{cursor:'pointer',position:'relative'}}>{value?<img src={value} style={{width:size,height:size,borderRadius:'50%',objectFit:'cover',border:'3px solid #4f8ef7'}}/>:<div style={{width:size,height:size,borderRadius:'50%',background:'rgba(255,255,255,0.1)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'32px',border:'2px dashed rgba(255,255,255,0.3)'}}>ЁЯУ╖</div>}<div style={{position:'absolute',bottom:0,right:0,background:'#4f8ef7',borderRadius:'50%',width:'22px',height:'22px',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'11px'}}>тЬП</div></div><input ref={r} type="file" accept="image/*" onChange={h} style={{display:'none'}}/><span style={{color:'#718096',fontSize:'12px'}}>ржЫржмрж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи</span></div>);}
function Flash({msg}){if(!msg)return null;return <div style={{background:'#2f855a',color:'#fff',padding:'10px',textAlign:'center',fontSize:'14px',position:'sticky',top:0,zIndex:50}}>{msg}</div>;}

function AnnouncePopup({text,onClose}){useEffect(()=>{const t=setTimeout(onClose,5000);return()=>clearTimeout(t);},[]);return(<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.65)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:2000,padding:'20px'}}><div style={{background:'linear-gradient(135deg,#1a2d45,#2d1a45)',borderRadius:'20px',padding:'28px',width:'100%',maxWidth:'400px',border:'1px solid rgba(255,255,255,0.15)',textAlign:'center',position:'relative'}}><button onClick={onClose} style={{position:'absolute',top:'12px',right:'12px',background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'50%',width:'28px',height:'28px',cursor:'pointer',fontSize:'14px'}}>x</button><div style={{fontSize:'40px',marginBottom:'10px'}}>ЁЯУв</div><div style={{color:'#fff',fontSize:'15px',lineHeight:'1.7'}}>{text}</div><div style={{color:'#718096',fontSize:'11px',marginTop:'14px'}}>рзл рж╕рзЗржХрзЗржирзНржб ржкрж░ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржмржирзНржз рж╣ржмрзЗ</div></div></div>);}

function Bell({userId,role,data,saveData}){const[open,setOpen]=useState(false);const myMsgs=data.messages.filter(m=>m.to===role||m.to===userId).slice().reverse();const unread=getUnread(userId,role,data.messages);const mark=()=>{const nd={...data,messages:data.messages.map(m=>(m.to===role||m.to===userId)&&!m.readBy.includes(userId)?{...m,readBy:[...m.readBy,userId]}:m)};saveData(nd);setOpen(true);};return(<div style={{position:'relative'}}><button onClick={mark} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'10px',padding:'7px 11px',cursor:'pointer',fontSize:'17px',position:'relative'}}>ЁЯФФ{unread>0&&<span style={{position:'absolute',top:'-4px',right:'-4px',background:'#fc8181',borderRadius:'50%',width:'17px',height:'17px',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'10px',fontWeight:'700'}}>{unread}</span>}</button>{open&&<div style={{position:'absolute',right:0,top:'44px',background:'#1a2332',borderRadius:'14px',border:'1px solid rgba(255,255,255,0.12)',width:'290px',maxHeight:'380px',overflowY:'auto',zIndex:200,boxShadow:'0 20px 60px rgba(0,0,0,0.5)'}}><div style={{padding:'12px 14px',borderBottom:'1px solid rgba(255,255,255,0.08)',display:'flex',justifyContent:'space-between',alignItems:'center'}}><span style={{color:'#fff',fontWeight:'700',fontSize:'14px'}}>ЁЯФФ ржмрж┐ржЬрзНржЮржкрзНрждрж┐</span><button onClick={()=>setOpen(false)} style={{background:'none',border:'none',color:'#718096',cursor:'pointer',fontSize:'16px'}}>x</button></div>{myMsgs.length===0?<div style={{padding:'20px',textAlign:'center',color:'#718096'}}>ржХрзЛржирзЛ ржмрж┐ржЬрзНржЮржкрзНрждрж┐ ржирзЗржЗ</div>:myMsgs.map(m=><div key={m.id} style={{padding:'11px 14px',borderBottom:'1px solid rgba(255,255,255,0.05)',background:m.readBy.includes(userId)?'transparent':'rgba(79,142,247,0.08)'}}><div style={{color:'#fff',fontSize:'13px',lineHeight:'1.5'}}>{m.text}</div><div style={{color:'#718096',fontSize:'11px',marginTop:'3px'}}>{new Date(m.date).toLocaleString('bn-BD')}</div></div>)}</div>}</div>);}

function OldLogin({data,onLogin}){const[phone,setPhone]=useState('');const[pass,setPass]=useState('');const[err,setErr]=useState('');const[role,setRole]=useState('admin');const go=()=>{setErr('');if(role==='admin'){const u=data.users.find(u=>u.role==='admin'&&u.phone===phone&&u.password===pass);if(u)return onLogin(u);}else if(role==='matkormi'){const u=data.matkormi.find(m=>m.phone===phone&&m.password===pass);if(u)return onLogin({...u,role:'matkormi'});}else{const u=data.grahok.find(g=>g.phone===phone&&g.password===pass);if(u)return onLogin({...u,role:'grahok'});}setErr('ржлрзЛржи ржиржорзНржмрж░ ржмрж╛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрзБрж▓!');};return(<div style={{minHeight:'100vh',background:'linear-gradient(135deg,#0f1923 0%,#1a2d45 50%,#0d2137 100%)',display:'flex',alignItems:'center',justifyContent:'center',padding:'20px',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{width:'100%',maxWidth:'380px'}}><div style={{textAlign:'center',marginBottom:'24px'}}><div style={{fontSize:'52px',marginBottom:'8px'}}>ЁЯПж</div><h1 style={{color:'#fff',fontSize:'24px',fontWeight:'800',margin:'0 0 4px'}}>рж╕ржорж┐рждрж┐ ржорзНржпрж╛ржирзЗржЬрж╛рж░</h1><p style={{color:'#718096',margin:0,fontSize:'13px'}}>ржЖржкржирж╛рж░ рж╕ржорж┐рждрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзБржи</p></div><div style={{background:'rgba(255,255,255,0.05)',borderRadius:'18px',padding:'22px',border:'1px solid rgba(255,255,255,0.1)'}}><div style={{display:'flex',gap:'5px',marginBottom:'16px',background:'rgba(0,0,0,0.2)',borderRadius:'10px',padding:'4px'}}>{[['admin','ржЕрзНржпрж╛ржбржорж┐ржи'],['matkormi','ржорж╛ржаржХрж░рзНржорзА'],['grahok','ржЧрзНрж░рж╛рж╣ржХ']].map(([v,l])=>(<button key={v} onClick={()=>setRole(v)} style={{flex:1,padding:'8px 4px',borderRadius:'7px',border:'none',background:role===v?'#4f8ef7':'transparent',color:role===v?'#fff':'#718096',fontWeight:'600',cursor:'pointer',fontSize:'12px',fontFamily:"'Hind Siliguri',sans-serif"}}>{l}</button>))}</div><Inp label="ржлрзЛржи ржиржорзНржмрж░" type="tel" placeholder="01XXXXXXXXX" value={phone} onChange={e=>setPhone(e.target.value)}/><Inp label="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи" value={pass} onChange={e=>setPass(e.target.value)} onKeyDown={e=>e.key==='Enter'&&go()}/>{err&&<div style={{color:'#fc8181',fontSize:'13px',marginBottom:'10px',textAlign:'center'}}>{err}</div>}<Btn ch="рж▓ржЧржЗржи ржХрж░рзБржи" onClick={go} full color="#4f8ef7"/>{role==='admin'&&<p style={{color:'#4a5568',fontSize:'11px',textAlign:'center',marginTop:'10px',marginBottom:0}}>ржбрж┐ржлрж▓рзНржЯ: 01700000000 / admin123</p>}</div><div style={{textAlign:'center',marginTop:'14px'}}><LiveClock/></div></div></div>);}

function GrahokProfile({grahok,data,saveData,onBack,isAdmin,onDelete}){const[editMd,setEditMd]=useState(false);const[form,setForm]=useState({});const[msg,setMsg]=useState('');const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};const g=data.grahok.find(x=>x.id===grahok.id)||grahok;const sav=getSav(g.id,data);const loan=getLoan(g.id,data);const pays=data.payments.filter(p=>p.grahokId===g.id).slice().reverse();const loans=data.loans.filter(l=>l.grahokId===g.id).slice().reverse();const dps=data.dps.filter(d=>d.grahokId===g.id);const mk=data.matkormi.find(m=>m.id===g.matkormId);const sc={pending:'#f6ad55',approved:'#48bb78',rejected:'#fc8181'};const sl={pending:'ржорзБрж▓рждрзБржмрж┐',approved:'тЬУ ржЕржирзБржорзЛржжрж┐ржд',rejected:'тЬХ ржмрж╛рждрж┐рж▓'};const save=()=>{saveData({...data,grahok:data.grahok.map(x=>x.id===g.id?{...x,name:form.name,phone:form.phone,photo:form.photo,matkormId:form.matkormId,...(form.npw?{password:form.npw}:{})}:x)});setEditMd(false);flash('рж╕ржВрж░ржХрзНрж╖ржг рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const dlP=()=>downloadCSV(g.name+'_payment.csv',pays.map(p=>[g.name,g.phone,p.type==='loan'?'рж▓рзЛржи':'рж╕ржЮрзНржЪржпрж╝',p.kistiType||'',p.amount,p.status,new Date(p.date).toLocaleDateString('bn-BD')]),['ржирж╛ржо','ржлрзЛржи','ржзрж░ржи','ржХрж┐рж╕рзНрждрж┐','ржкрж░рж┐ржорж╛ржг','ржЕржмрж╕рзНржерж╛','рждрж╛рж░рж┐ржЦ']);const dlL=()=>downloadCSV(g.name+'_loan.csv',loans.map(l=>[g.name,g.phone,l.amount,l.kistiType,l.status,new Date(l.date).toLocaleDateString('bn-BD')]),['ржирж╛ржо','ржлрзЛржи','ржкрж░рж┐ржорж╛ржг','ржХрж┐рж╕рзНрждрж┐','ржЕржмрж╕рзНржерж╛','рждрж╛рж░рж┐ржЦ']);return(<div><Flash msg={msg}/><div style={{display:'flex',alignItems:'center',gap:'10px',marginBottom:'14px'}}><button onClick={onBack} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'10px',padding:'7px 13px',cursor:'pointer',fontSize:'13px'}}>тЖР ржкрж┐ржЫржирзЗ</button><h2 style={{color:'#fff',margin:0,fontSize:'17px'}}>ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓</h2></div><Crd sx={{marginBottom:'13px',textAlign:'center'}}><div style={{display:'flex',justifyContent:'center',marginBottom:'10px'}}><Av name={g.name} photo={g.photo} size={68}/></div><div style={{color:'#fff',fontWeight:'800',fontSize:'19px'}}>{g.name}</div><div style={{color:'#718096',fontSize:'13px'}}>ЁЯУ▒ {g.phone}</div>{g.grahokId&&<div style={{color:'#a78bfa',fontSize:'13px',fontWeight:'600'}}>ЁЯЖФ {g.grahokId}</div>}{mk&&<div style={{color:'#718096',fontSize:'12px'}}>ЁЯС╖ {mk.name}</div>}{g.location&&<a href={'https://maps.google.com/?q='+g.location.lat+','+g.location.lng} target="_blank" rel="noreferrer" style={{display:'inline-block',marginTop:'5px',color:'#4f8ef7',fontSize:'12px',textDecoration:'none'}}>ЁЯУН рж▓рзЛржХрзЗрж╢ржи ржжрзЗржЦрзБржи</a>}<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'10px',marginTop:'12px'}}><div style={{background:'rgba(72,187,120,0.12)',borderRadius:'10px',padding:'10px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржорзЛржЯ рж╕ржЮрзНржЪржпрж╝</div><div style={{color:'#48bb78',fontWeight:'800',fontSize:'19px'}}>рз│{sav.toLocaleString()}</div></div><div style={{background:'rgba(246,173,85,0.12)',borderRadius:'10px',padding:'10px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржорзЛржЯ ржЛржг</div><div style={{color:'#f6ad55',fontWeight:'800',fontSize:'19px'}}>рз│{loan.toLocaleString()}</div></div></div>{isAdmin&&<div style={{display:'flex',gap:'8px',marginTop:'12px',justifyContent:'center',flexWrap:'wrap'}}><Btn ch="тЬП рж╕ржорзНржкрж╛ржжржирж╛" onClick={()=>{setForm({...g,npw:''});setEditMd(true);}} sm outline color="#4f8ef7"/><Btn ch="ЁЯЧС ржорзБржЫрзБржи" onClick={()=>onDelete&&onDelete(g.id)} sm color="#fc8181"/></div>}</Crd><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'}}><h3 style={{color:'#fff',fontSize:'14px',margin:0}}>ЁЯТ│ ржкрзЗржорзЗржирзНржЯ ржЗрждрж┐рж╣рж╛рж╕ ({pays.length})</h3>{pays.length>0&&<button onClick={dlP} style={{background:'rgba(72,187,120,0.15)',border:'1px solid rgba(72,187,120,0.3)',color:'#48bb78',borderRadius:'8px',padding:'5px 10px',cursor:'pointer',fontSize:'12px',fontFamily:"'Hind Siliguri',sans-serif"}}>тмЗ ржбрж╛ржЙржирж▓рзЛржб</button>}</div>{pays.length===0?<Crd sx={{marginBottom:'12px'}}><div style={{color:'#718096',textAlign:'center',padding:'14px'}}>ржХрзЛржирзЛ ржкрзЗржорзЗржирзНржЯ ржирзЗржЗ</div></Crd>:pays.map(p=><div key={p.id} style={{display:'flex',justifyContent:'space-between',padding:'9px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><div style={{color:'#fff',fontSize:'13px'}}>{p.type==='loan'?'ржЛржг ржкрж░рж┐рж╢рзЛржз':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType}</div><div style={{color:'#718096',fontSize:'11px'}}>{new Date(p.date).toLocaleDateString('bn-BD')}</div></div><div style={{textAlign:'right'}}><div style={{color:'#ecc94b',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</div><div style={{color:sc[p.status],fontSize:'11px'}}>{sl[p.status]}</div></div></div>)}<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px',marginTop:'16px'}}><h3 style={{color:'#fff',fontSize:'14px',margin:0}}>ЁЯТ░ ржЛржгрзЗрж░ ржЗрждрж┐рж╣рж╛рж╕ ({loans.length})</h3>{loans.length>0&&<button onClick={dlL} style={{background:'rgba(246,173,85,0.15)',border:'1px solid rgba(246,173,85,0.3)',color:'#f6ad55',borderRadius:'8px',padding:'5px 10px',cursor:'pointer',fontSize:'12px',fontFamily:"'Hind Siliguri',sans-serif"}}>тмЗ ржбрж╛ржЙржирж▓рзЛржб</button>}</div>{loans.map(l=><div key={l.id} style={{display:'flex',justifyContent:'space-between',padding:'9px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><div style={{color:'#fff',fontSize:'13px'}}>рз│{l.amount.toLocaleString()} тАв {l.kistiType}</div><div style={{color:'#718096',fontSize:'11px'}}>{new Date(l.date).toLocaleDateString('bn-BD')}</div></div><span style={{color:sc[l.status],fontSize:'12px',fontWeight:'600'}}>{sl[l.status]}</span></div>)}{dps.map(d=><Crd key={d.id} sx={{marginTop:'8px'}}><div style={{display:'flex',justifyContent:'space-between'}}><div><div style={{color:'#fff',fontWeight:'600'}}>DPS рз│{d.monthlyAmount?.toLocaleString()}/ржорж╛рж╕</div><div style={{color:'#718096',fontSize:'12px'}}>{d.duration} ржорж╛рж╕</div></div><span style={{color:d.status==='active'?'#48bb78':'#f6ad55',fontSize:'12px'}}>{d.status==='active'?'тЬЕ рж╕ржХрзНрж░рж┐ржпрж╝':'тП│ ржорзБрж▓рждрзБржмрж┐'}</span></div></Crd>)}{editMd&&<Md title="ржЧрзНрж░рж╛рж╣ржХ рж╕ржорзНржкрж╛ржжржирж╛" onClose={()=>setEditMd(false)}><PhotoPick value={form.photo} onChange={v=>setForm({...form,photo:v})}/><Inp label="ржирж╛ржо" value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})}/><Inp label="ржлрзЛржи" value={form.phone||''} onChange={e=>setForm({...form,phone:e.target.value})}/><Inp label="ржирждрзБржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ ржХрж░рж▓рзЗ ржлрж╛ржБржХрж╛ рж░рж╛ржЦрзБржи" value={form.npw||''} onChange={e=>setForm({...form,npw:e.target.value})}/><Slct label="ржорж╛ржаржХрж░рзНржорзА" value={form.matkormId||''} onChange={e=>setForm({...form,matkormId:e.target.value})}><option value="">-- ржирзЗржЗ --</option>{data.matkormi.map(m=><option key={m.id} value={m.id}>{m.name}</option>)}</Slct><Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={save} full/></Md>}</div>);}

function MatkormiProfile({matkormi,data,saveData,onBack,onViewGrahok,isAdmin}){const[editMd,setEditMd]=useState(false);const[form,setForm]=useState({});const[msg,setMsg]=useState('');const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};const m=data.matkormi.find(x=>x.id===matkormi.id)||matkormi;const myG=data.grahok.filter(g=>g.matkormId===m.id);const myP=data.payments.filter(p=>p.matkormId===m.id);const approvedP=myP.filter(p=>p.status==='approved');const total=approvedP.reduce((s,p)=>s+p.amount,0);const save=()=>{saveData({...data,matkormi:data.matkormi.map(x=>x.id===m.id?{...x,name:form.name,phone:form.phone,area:form.area,photo:form.photo,...(form.npw?{password:form.npw}:{})}:x)});setEditMd(false);flash('рж╕ржВрж░ржХрзНрж╖ржг рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const del=()=>{if(!confirm('ржорж╛ржаржХрж░рзНржорзА ржорзБржЫржмрзЗржи?'))return;saveData({...data,matkormi:data.matkormi.filter(x=>x.id!==m.id)});onBack();};const dl=()=>downloadCSV(m.name+'_history.csv',myP.slice().reverse().map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);return[m.name,g?.name,g?.phone,p.type==='loan'?'ржЛржг':'рж╕ржЮрзНржЪржпрж╝',p.kistiType,p.amount,p.status,new Date(p.date).toLocaleDateString('bn-BD')];}),['ржорж╛ржаржХрж░рзНржорзА','ржЧрзНрж░рж╛рж╣ржХ','ржЧрзНрж░рж╛рж╣ржХ ржлрзЛржи','ржзрж░ржи','ржХрж┐рж╕рзНрждрж┐','ржкрж░рж┐ржорж╛ржг','ржЕржмрж╕рзНржерж╛','рждрж╛рж░рж┐ржЦ']);return(<div><Flash msg={msg}/><div style={{display:'flex',alignItems:'center',gap:'10px',marginBottom:'14px'}}><button onClick={onBack} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'10px',padding:'7px 13px',cursor:'pointer',fontSize:'13px'}}>тЖР ржкрж┐ржЫржирзЗ</button><h2 style={{color:'#fff',margin:0,fontSize:'17px'}}>ржорж╛ржаржХрж░рзНржорзАрж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓</h2></div><Crd sx={{marginBottom:'13px',textAlign:'center'}}><div style={{display:'flex',justifyContent:'center',marginBottom:'10px'}}><Av name={m.name} photo={m.photo} size={68}/></div><div style={{color:'#fff',fontWeight:'800',fontSize:'19px'}}>{m.name}</div><div style={{color:'#718096',fontSize:'13px'}}>ЁЯУ▒ {m.phone}</div>{m.area&&<div style={{color:'#718096',fontSize:'12px'}}>ЁЯУН {m.area}</div>}{m.location&&<a href={'https://maps.google.com/?q='+m.location.lat+','+m.location.lng} target="_blank" rel="noreferrer" style={{display:'inline-block',marginTop:'5px',color:'#4f8ef7',fontSize:'12px',textDecoration:'none'}}>ЁЯУН рж▓рзЛржХрзЗрж╢ржи ржжрзЗржЦрзБржи</a>}<div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'8px',marginTop:'12px'}}><div style={{background:'rgba(79,142,247,0.12)',borderRadius:'10px',padding:'10px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржЧрзНрж░рж╛рж╣ржХ</div><div style={{color:'#4f8ef7',fontWeight:'800',fontSize:'20px'}}>{myG.length}</div></div><div style={{background:'rgba(72,187,120,0.12)',borderRadius:'10px',padding:'10px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржорзЛржЯ ржЖржжрж╛ржпрж╝</div><div style={{color:'#48bb78',fontWeight:'800',fontSize:'15px'}}>рз│{total.toLocaleString()}</div></div><div style={{background:'rgba(246,173,85,0.12)',borderRadius:'10px',padding:'10px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржЬржорж╛</div><div style={{color:'#f6ad55',fontWeight:'800',fontSize:'20px'}}>{approvedP.length}</div></div></div>{isAdmin&&<div style={{display:'flex',gap:'8px',marginTop:'12px',justifyContent:'center'}}><Btn ch="тЬП рж╕ржорзНржкрж╛ржжржирж╛" onClick={()=>{setForm({...m,npw:''});setEditMd(true);}} sm outline color="#4f8ef7"/><Btn ch="ЁЯЧС ржорзБржЫрзБржи" onClick={del} sm color="#fc8181"/></div>}</Crd><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'}}><h3 style={{color:'#fff',fontSize:'14px',margin:0}}>ЁЯСе ржЧрзНрж░рж╛рж╣ржХрж░рж╛ ({myG.length})</h3>{myP.length>0&&<button onClick={dl} style={{background:'rgba(79,142,247,0.15)',border:'1px solid rgba(79,142,247,0.3)',color:'#4f8ef7',borderRadius:'8px',padding:'5px 10px',cursor:'pointer',fontSize:'12px',fontFamily:"'Hind Siliguri',sans-serif"}}>тмЗ ржбрж╛ржЙржирж▓рзЛржб</button>}</div>{myG.map(g=><Crd key={g.id} sx={{marginBottom:'9px',cursor:'pointer'}} onClick={()=>onViewGrahok&&onViewGrahok(g)}><div style={{display:'flex',alignItems:'center',gap:'11px'}}><Av name={g.name} photo={g.photo} size={42}/><div style={{flex:1}}><div style={{color:'#fff',fontWeight:'600'}}>{g.name}</div><div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {g.phone}</div></div><div style={{textAlign:'right'}}><div style={{color:'#48bb78',fontWeight:'700'}}>рз│{getSav(g.id,data).toLocaleString()}</div><div style={{color:'#f6ad55',fontSize:'11px'}}>ржЛржг: рз│{getLoan(g.id,data).toLocaleString()}</div></div></div></Crd>)}<h3 style={{color:'#fff',fontSize:'14px',marginBottom:'10px',marginTop:'14px'}}>ЁЯУЛ ржкрзЗржорзЗржирзНржЯ ржЗрждрж┐рж╣рж╛рж╕</h3>{myP.slice().reverse().slice(0,20).map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);const sc={pending:'#f6ad55',approved:'#48bb78',rejected:'#fc8181'};const sl={pending:'ржорзБрж▓рждрзБржмрж┐',approved:'тЬУ',rejected:'тЬХ'};return(<div key={p.id} style={{display:'flex',justifyContent:'space-between',padding:'9px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><div style={{color:'#fff',fontSize:'13px'}}>{g?.name} тАв {p.type==='loan'?'ржЛржг':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType}</div><div style={{color:'#718096',fontSize:'11px'}}>{new Date(p.date).toLocaleDateString('bn-BD')}</div></div><div style={{textAlign:'right'}}><div style={{color:'#ecc94b',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</div><div style={{color:sc[p.status],fontSize:'11px'}}>{sl[p.status]}</div></div></div>);})} {editMd&&<Md title="ржорж╛ржаржХрж░рзНржорзА рж╕ржорзНржкрж╛ржжржирж╛" onClose={()=>setEditMd(false)}><PhotoPick value={form.photo} onChange={v=>setForm({...form,photo:v})}/><Inp label="ржирж╛ржо" value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})}/><Inp label="ржлрзЛржи" value={form.phone||''} onChange={e=>setForm({...form,phone:e.target.value})}/><Inp label="ржирждрзБржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ ржХрж░рж▓рзЗ ржлрж╛ржБржХрж╛ рж░рж╛ржЦрзБржи" value={form.npw||''} onChange={e=>setForm({...form,npw:e.target.value})}/><Inp label="ржПрж▓рж╛ржХрж╛" value={form.area||''} onChange={e=>setForm({...form,area:e.target.value})}/><Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={save} full/></Md>}</div>);}

function AdminPanel({data,saveData,currentUser,onLogout}){const[tab,setTab]=useState('overview');const[page,setPage]=useState(null);const[md,setMd]=useState(null);const[form,setForm]=useState({});const[msg,setMsg]=useState('');const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};const adm=data.users.find(u=>u.id==='admin1')||currentUser;const pP=data.payments.filter(p=>p.status==='pending');const pL=data.loans.filter(l=>l.status==='pending');const pD=data.dps.filter(d=>d.status==='pending');const totalSav=data.grahok.reduce((s,g)=>s+getSav(g.id,data),0);const approveP=id=>{saveData({...data,payments:data.payments.map(p=>p.id===id?{...p,status:'approved'}:p)});flash('ржЕржирзБржорзЛржжржи рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const rejectP=id=>{saveData({...data,payments:data.payments.map(p=>p.id===id?{...p,status:'rejected'}:p)});flash('ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ');};const approveL=id=>{saveData({...data,loans:data.loans.map(l=>l.id===id?{...l,status:'approved'}:l)});flash('ржЛржг ржЕржирзБржорзЛржжржи рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const rejectL=id=>{saveData({...data,loans:data.loans.map(l=>l.id===id?{...l,status:'rejected'}:l)});flash('ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ');};const approveDPS=id=>{saveData({...data,dps:data.dps.map(d=>d.id===id?{...d,status:'active'}:d)});flash('DPS ржЕржирзБржорзЛржжржи тЬУ');};const rejectDPS=id=>{saveData({...data,dps:data.dps.map(d=>d.id===id?{...d,status:'rejected'}:d)});flash('ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ');};const delG=id=>{if(!confirm('ржЧрзНрж░рж╛рж╣ржХ ржорзБржЫржмрзЗржи?'))return;saveData({...data,grahok:data.grahok.filter(g=>g.id!==id)});setPage(null);};const addMk=()=>{if(!form.name||!form.phone||!form.pw)return;saveData({...data,matkormi:[...data.matkormi,{id:uid(),name:form.name,phone:form.phone,password:form.pw,photo:form.photo||null,area:form.area||''}]});setMd(null);setForm({});flash('ржорж╛ржаржХрж░рзНржорзА ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const addG=()=>{if(!form.name||!form.phone||!form.pw)return;const cnt=(data.grahokCounter||0)+1;const gid='GRK-'+String(cnt).padStart(4,'0');saveData({...data,grahokCounter:cnt,grahok:[...data.grahok,{id:uid(),grahokId:gid,name:form.name,phone:form.phone,password:form.pw,photo:form.photo||null,matkormId:form.mkId||null,joinDate:new Date().toISOString()}]});setMd(null);setForm({});flash('ржЧрзНрж░рж╛рж╣ржХ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const sendMsg=()=>{if(!form.mto||!form.mtxt)return;const m={id:uid(),to:form.mto,text:form.mtxt,date:new Date().toISOString(),readBy:[]};saveData({...data,messages:[...data.messages,m]});setMd(null);setForm({});flash('ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const saveSt=()=>{saveData({...data,settings:{...data.settings,...form}});setMd(null);setForm({});flash('рж╕рзЗржЯрж┐ржВрж╕ рж╕ржВрж░ржХрзНрж╖ржг рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const saveAdminProf=()=>{if(!form.apn||!form.app)return;saveData({...data,users:data.users.map(u=>u.id==='admin1'?{...u,name:form.apn,phone:form.app,...(form.appw?{password:form.appw}:{})}:u)});setMd(null);setForm({});flash('ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const saveAnn=()=>{saveData({...data,announcement:{text:form.ant||data.announcement?.text||'',active:form.ana!==undefined?form.ana:(data.announcement?.active||false)}});flash('ржШрзЛрж╖ржгрж╛ рж╕ржВрж░ржХрзНрж╖ржг рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const dlAll=()=>{const rows=data.grahok.map(g=>[g.name,g.phone,getSav(g.id,data),getLoan(g.id,data),data.matkormi.find(m=>m.id===g.matkormId)?.name||'']);downloadCSV('all_grahok.csv',rows,['ржирж╛ржо','ржлрзЛржи','рж╕ржЮрзНржЪржпрж╝','ржЛржг','ржорж╛ржаржХрж░рзНржорзА']);};
const tabs=[{id:'overview',l:'ЁЯУК рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк'},{id:'matkormi',l:'ЁЯС╖ ржорж╛ржаржХрж░рзНржорзА'},{id:'grahok',l:'ЁЯСе ржЧрзНрж░рж╛рж╣ржХ'},{id:'search',l:'ЁЯФН ржЦрзБржБржЬрзБржи'},{id:'payments',l:'ЁЯТ│ ржкрзЗржорзЗржирзНржЯ'+(pP.length>0?' ('+pP.length+')':'')},{id:'loans',l:'ЁЯТ░ ржЛржг'+(pL.length>0?' ('+pL.length+')':'')},{id:'dps',l:'ЁЯПж DPS'+(pD.length>0?' ('+pD.length+')':'')},{id:'msg',l:'ЁЯУв ржмрж╛рж░рзНрждрж╛'},{id:'settings',l:'тЪЩ рж╕рзЗржЯрж┐ржВрж╕'}];
if(page?.type==='gp')return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{background:'linear-gradient(135deg,#1a2d45,#0d2137)',padding:'13px 18px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}><div style={{display:'flex',alignItems:'center',gap:'10px'}}><Av name={adm.name} photo={adm.photo} size={34}/><div style={{color:'#fff',fontWeight:'700',fontSize:'14px'}}>{adm.name}</div></div><div style={{display:'flex',gap:'8px'}}><LiveClock/><button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button></div></div></div><div style={{maxWidth:'700px',margin:'0 auto',padding:'18px'}}><GrahokProfile grahok={page.e} data={data} saveData={saveData} onBack={()=>page.from?setPage(page.from):setPage(null)} isAdmin onDelete={delG}/></div></div>);
if(page?.type==='mp')return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{background:'linear-gradient(135deg,#1a2d45,#0d2137)',padding:'13px 18px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}><div style={{display:'flex',alignItems:'center',gap:'10px'}}><Av name={adm.name} photo={adm.photo} size={34}/><div style={{color:'#fff',fontWeight:'700',fontSize:'14px'}}>{adm.name}</div></div><div style={{display:'flex',gap:'8px'}}><LiveClock/><button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button></div></div></div><div style={{maxWidth:'700px',margin:'0 auto',padding:'18px'}}><MatkormiProfile matkormi={page.e} data={data} saveData={saveData} onBack={()=>setPage(null)} isAdmin onViewGrahok={g=>setPage({type:'gp',e:g,from:page})}/></div></div>);
return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{background:'linear-gradient(135deg,#1a2d45,#0d2137)',padding:'13px 18px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',maxWidth:'900px',margin:'0 auto'}}><div style={{display:'flex',alignItems:'center',gap:'10px'}}><div style={{fontSize:'26px'}}>ЁЯПж</div><div><div style={{color:'#fff',fontWeight:'800',fontSize:'16px'}}>рж╕ржорж┐рждрж┐ ржорзНржпрж╛ржирзЗржЬрж╛рж░</div><div style={{color:'#718096',fontSize:'11px'}}>ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</div></div></div><div style={{display:'flex',alignItems:'center',gap:'8px'}}><LiveClock/><Av name={adm.name} photo={adm.photo} size={32}/><button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button></div></div></div><Flash msg={msg}/><div style={{background:'rgba(255,255,255,0.03)',borderBottom:'1px solid rgba(255,255,255,0.06)',overflowX:'auto'}}><div style={{display:'flex',maxWidth:'900px',margin:'0 auto'}}>{tabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{padding:'11px 12px',border:'none',background:'transparent',color:tab===t.id?'#4f8ef7':'#718096',borderBottom:tab===t.id?'2px solid #4f8ef7':'2px solid transparent',fontWeight:tab===t.id?'700':'500',cursor:'pointer',fontSize:'12px',whiteSpace:'nowrap',fontFamily:"'Hind Siliguri',sans-serif"}}>{t.l}</button>)}</div></div><div style={{maxWidth:'900px',margin:'0 auto',padding:'16px'}}>
{tab==='overview'&&<div><div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(140px,1fr))',gap:'11px',marginBottom:'16px'}}><Stat label="ржорж╛ржаржХрж░рзНржорзА" value={data.matkormi.length} icon="ЁЯС╖" color="#4f8ef7"/><Stat label="ржЧрзНрж░рж╛рж╣ржХ" value={data.grahok.length} icon="ЁЯСе" color="#48bb78"/><Stat label="ржорзЛржЯ рж╕ржЮрзНржЪржпрж╝" value={'рз│'+totalSav.toLocaleString()} icon="ЁЯТ░" color="#ecc94b"/><Stat label="ржорзБрж▓рждрзБржмрж┐ ржкрзЗржорзЗржирзНржЯ" value={pP.length} icon="тП│" color="#fc8181"/><Stat label="ржорзБрж▓рждрзБржмрж┐ ржЛржг" value={pL.length} icon="ЁЯУЛ" color="#f6ad55"/><Stat label="ржЕржирзБржорзЛржжрж┐ржд ржЛржг" value={data.loans.filter(l=>l.status==='approved').length} icon="тЬЕ" color="#68d391"/></div><div style={{marginBottom:'14px'}}><Btn ch="тмЗ рж╕ржм ржЧрзНрж░рж╛рж╣ржХ ржбрж╛ржЙржирж▓рзЛржб (CSV)" onClick={dlAll} sm color="#718096"/></div>{pP.length>0&&<Crd><h3 style={{color:'#fc8181',margin:'0 0 10px',fontSize:'14px'}}>тЪа ржорзБрж▓рждрзБржмрж┐ ржкрзЗржорзЗржирзНржЯ ({pP.length})</h3>{pP.slice(0,5).map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);const mk=data.matkormi.find(x=>x.id===p.matkormId);return(<div key={p.id} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'9px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><div style={{color:'#fff',fontSize:'13px',fontWeight:'600'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'11px'}}>{mk?.name} тАв {p.type==='loan'?'ржЛржг':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType}</div></div><div style={{display:'flex',alignItems:'center',gap:'7px'}}><span style={{color:'#ecc94b',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</span><Btn ch="тЬУ" onClick={()=>approveP(p.id)} sm color="#48bb78"/><Btn ch="тЬХ" onClick={()=>rejectP(p.id)} sm color="#fc8181"/></div></div>);})}</Crd>}</div>}
{tab==='matkormi'&&<div><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}><h2 style={{color:'#fff',margin:0,fontSize:'17px'}}>ржорж╛ржаржХрж░рзНржорзА рждрж╛рж▓рж┐ржХрж╛</h2><Btn ch="+ ржирждрзБржи ржорж╛ржаржХрж░рзНржорзА" onClick={()=>{setForm({});setMd('addMk');}} color="#4f8ef7"/></div>{data.matkormi.length===0?<Crd><div style={{textAlign:'center',color:'#718096',padding:'28px'}}>ржХрзЛржирзЛ ржорж╛ржаржХрж░рзНржорзА ржирзЗржЗ</div></Crd>:data.matkormi.map(m=><Crd key={m.id} sx={{marginBottom:'9px',cursor:'pointer'}} onClick={()=>setPage({type:'mp',e:m})}><div style={{display:'flex',alignItems:'center',gap:'11px'}}><Av name={m.name} photo={m.photo} size={48}/><div style={{flex:1}}><div style={{color:'#fff',fontWeight:'700',fontSize:'15px'}}>{m.name}</div><div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {m.phone}</div>{m.area&&<div style={{color:'#718096',fontSize:'11px'}}>ЁЯУН {m.area}</div>}</div><div style={{textAlign:'right'}}><div style={{color:'#4f8ef7',fontWeight:'700'}}>{data.grahok.filter(g=>g.matkormId===m.id).length} ржЬржи</div><div style={{color:'#718096',fontSize:'11px'}}>ржкрзНрж░рзЛржлрж╛ржЗрж▓ тЖТ</div></div></div></Crd>)}</div>}
{tab==='grahok'&&<div><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}><h2 style={{color:'#fff',margin:0,fontSize:'17px'}}>ржЧрзНрж░рж╛рж╣ржХ рждрж╛рж▓рж┐ржХрж╛</h2><div style={{display:'flex',gap:'8px'}}><Btn ch="тмЗ CSV" onClick={dlAll} sm outline color="#718096"/><Btn ch="+ ржирждрзБржи ржЧрзНрж░рж╛рж╣ржХ" onClick={()=>{setForm({});setMd('addG');}} color="#48bb78"/></div></div>{data.grahok.length===0?<Crd><div style={{textAlign:'center',color:'#718096',padding:'28px'}}>ржХрзЛржирзЛ ржЧрзНрж░рж╛рж╣ржХ ржирзЗржЗ</div></Crd>:data.grahok.map(g=>{const s=getSav(g.id,data);const l=getLoan(g.id,data);const mk=data.matkormi.find(m=>m.id===g.matkormId);return(<Crd key={g.id} sx={{marginBottom:'9px',cursor:'pointer'}} onClick={()=>setPage({type:'gp',e:g})}><div style={{display:'flex',alignItems:'center',gap:'11px'}}><Av name={g.name} photo={g.photo} size={46}/><div style={{flex:1}}><div style={{color:'#fff',fontWeight:'700',fontSize:'15px'}}>{g.name}</div><div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {g.phone}</div>{mk&&<div style={{color:'#718096',fontSize:'11px'}}>ЁЯС╖ {mk.name}</div>}</div><div style={{textAlign:'right'}}><div style={{color:'#48bb78',fontSize:'13px',fontWeight:'700'}}>рз│{s.toLocaleString()}</div><div style={{color:'#718096',fontSize:'10px'}}>рж╕ржЮрзНржЪржпрж╝</div>{l>0&&<><div style={{color:'#f6ad55',fontSize:'13px',fontWeight:'700'}}>рз│{l.toLocaleString()}</div><div style={{color:'#718096',fontSize:'10px'}}>ржЛржг</div></>}<div style={{color:'#718096',fontSize:'11px',marginTop:'3px'}}>ржкрзНрж░рзЛржлрж╛ржЗрж▓ тЖТ</div></div></div></Crd>);})}</div>}
{tab==='search'&&<SearchTab data={data} saveData={saveData}/>}
{tab==='payments'&&<div><h2 style={{color:'#fff',marginBottom:'12px'}}>ржкрзЗржорзЗржирзНржЯ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛</h2><h3 style={{color:'#fc8181',fontSize:'13px',marginBottom:'9px'}}>ржорзБрж▓рждрзБржмрж┐ ({pP.length})</h3>{pP.length===0?<Crd sx={{marginBottom:'12px'}}><div style={{textAlign:'center',color:'#718096',padding:'14px'}}>ржХрзЛржирзЛ ржорзБрж▓рждрзБржмрж┐ ржирзЗржЗ</div></Crd>:pP.map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);const mk=data.matkormi.find(x=>x.id===p.matkormId);return(<Crd key={p.id} sx={{marginBottom:'9px',border:'1px solid rgba(252,129,74,0.3)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px'}}><div><div style={{color:'#fff',fontWeight:'700'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'12px'}}>{mk?.name} тАв {p.type==='loan'?'ржЛржг ржкрзЗржорзЗржирзНржЯ':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType}</div>{p.grahokPhone&&<div style={{color:'#718096',fontSize:'11px'}}>ЁЯУ▒ {p.grahokPhone}</div>}{p.note&&<div style={{color:'#a0aec0',fontSize:'11px'}}>{p.note}</div>}</div><div style={{textAlign:'right'}}><div style={{color:'#ecc94b',fontWeight:'800',fontSize:'17px',marginBottom:'5px'}}>рз│{p.amount.toLocaleString()}</div><div style={{display:'flex',gap:'5px'}}><Btn ch="тЬУ ржЕржирзБржорзЛржжржи" onClick={()=>approveP(p.id)} sm color="#48bb78"/><Btn ch="тЬХ" onClick={()=>rejectP(p.id)} sm color="#fc8181"/></div></div></div></Crd>);})}<h3 style={{color:'#48bb78',fontSize:'13px',marginBottom:'8px',marginTop:'14px'}}>ржЕржирзБржорзЛржжрж┐ржд ржкрзЗржорзЗржирзНржЯ</h3>{data.payments.filter(p=>p.status==='approved').slice().reverse().slice(0,30).map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);return(<div key={p.id} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><span style={{color:'#fff',fontSize:'13px'}}>{g?.name}</span><span style={{color:'#718096',fontSize:'11px',marginLeft:'7px'}}>{p.type==='loan'?'ржЛржг':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType} тАв {new Date(p.date).toLocaleDateString('bn-BD')}</span></div><span style={{color:'#48bb78',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</span></div>);})}</div>}
{tab==='loans'&&<div><h2 style={{color:'#fff',marginBottom:'12px'}}>ржЛржг ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛</h2><h3 style={{color:'#fc8181',fontSize:'13px',marginBottom:'9px'}}>ржорзБрж▓рждрзБржмрж┐ ({pL.length})</h3>{pL.length===0?<Crd sx={{marginBottom:'12px'}}><div style={{textAlign:'center',color:'#718096',padding:'14px'}}>ржХрзЛржирзЛ ржорзБрж▓рждрзБржмрж┐ ржирзЗржЗ</div></Crd>:pL.map(l=>{const g=data.grahok.find(x=>x.id===l.grahokId);return(<Crd key={l.id} sx={{marginBottom:'9px',border:'1px solid rgba(246,173,85,0.3)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px'}}><div><div style={{color:'#fff',fontWeight:'700'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {g?.phone} тАв {l.kistiType}</div>{l.purpose&&<div style={{color:'#a0aec0',fontSize:'11px'}}>{l.purpose}</div>}</div><div style={{textAlign:'right'}}><div style={{color:'#f6ad55',fontWeight:'800',fontSize:'18px',marginBottom:'5px'}}>рз│{l.amount.toLocaleString()}</div><div style={{display:'flex',gap:'5px'}}><Btn ch="тЬУ ржЕржирзБржорзЛржжржи" onClick={()=>approveL(l.id)} sm color="#48bb78"/><Btn ch="тЬХ" onClick={()=>rejectL(l.id)} sm color="#fc8181"/></div></div></div></Crd>);})}<h3 style={{color:'#48bb78',fontSize:'13px',marginBottom:'8px',marginTop:'14px'}}>ржЕржирзБржорзЛржжрж┐ржд ржЛржг</h3>{data.loans.filter(l=>l.status==='approved').slice().reverse().map(l=>{const g=data.grahok.find(x=>x.id===l.grahokId);return(<div key={l.id} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><span style={{color:'#fff',fontSize:'13px'}}>{g?.name}</span><span style={{color:'#718096',fontSize:'11px',marginLeft:'7px'}}>{l.kistiType}</span></div><span style={{color:'#68d391',fontWeight:'700'}}>рз│{l.amount.toLocaleString()}</span></div>);})}</div>}
{tab==='dps'&&<div><h2 style={{color:'#fff',marginBottom:'12px'}}>DPS ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛</h2>{pD.length>0&&<><h3 style={{color:'#fc8181',fontSize:'13px',marginBottom:'9px'}}>ржорзБрж▓рждрзБржмрж┐ ({pD.length})</h3>{pD.map(d=>{const g=data.grahok.find(x=>x.id===d.grahokId);return(<Crd key={d.id} sx={{marginBottom:'9px',border:'1px solid rgba(79,142,247,0.3)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px'}}><div><div style={{color:'#fff',fontWeight:'700'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'12px'}}>рз│{d.monthlyAmount?.toLocaleString()}/ржорж╛рж╕ тАв {d.duration} ржорж╛рж╕</div>{d.txnId&&<div style={{color:'#a0aec0',fontSize:'11px'}}>TXN: {d.txnId} тАв {d.senderNumber} тАв {d.paymentApp}</div>}</div><div style={{display:'flex',gap:'5px'}}><Btn ch="тЬУ ржЕржирзБржорзЛржжржи" onClick={()=>approveDPS(d.id)} sm color="#48bb78"/><Btn ch="тЬХ" onClick={()=>rejectDPS(d.id)} sm color="#fc8181"/></div></div></Crd>);})}</>}<h3 style={{color:'#48bb78',fontSize:'13px',marginBottom:'8px'}}>рж╕ржХрзНрж░рж┐ржпрж╝ DPS</h3>{data.dps.filter(d=>d.status==='active').map(d=>{const g=data.grahok.find(x=>x.id===d.grahokId);return(<Crd key={d.id} sx={{marginBottom:'8px'}}><div style={{display:'flex',justifyContent:'space-between'}}><div><div style={{color:'#fff',fontWeight:'600'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'12px'}}>рз│{d.monthlyAmount?.toLocaleString()}/ржорж╛рж╕ тАв {d.duration} ржорж╛рж╕</div></div><span style={{color:'#48bb78',fontSize:'12px'}}>тЬЕ рж╕ржХрзНрж░рж┐ржпрж╝</span></div></Crd>);})}</div>}
{tab==='msg'&&<div><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}><h2 style={{color:'#fff',margin:0}}>ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржи</h2><Btn ch="+ ржирждрзБржи ржмрж╛рж░рзНрждрж╛" onClick={()=>{setForm({});setMd('sendMsg');}} color="#a78bfa"/></div><Crd sx={{marginBottom:'14px'}}><h3 style={{color:'#fff',fontSize:'14px',margin:'0 0 10px'}}>ЁЯУв рж▓ржЧржЗржи ржШрзЛрж╖ржгрж╛</h3><div style={{display:'flex',gap:'10px',alignItems:'center',marginBottom:'8px'}}><input type="checkbox" checked={form.ana!==undefined?form.ana:(data.announcement?.active||false)} onChange={e=>setForm({...form,ana:e.target.checked})} id="aa"/><label htmlFor="aa" style={{color:'#a0aec0',fontSize:'13px'}}>ржШрзЛрж╖ржгрж╛ рж╕ржХрзНрж░рж┐ржпрж╝</label></div><Inp placeholder="ржШрзЛрж╖ржгрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ..." value={form.ant!==undefined?form.ant:(data.announcement?.text||'')} onChange={e=>setForm({...form,ant:e.target.value})}/><Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={saveAnn} sm color="#a78bfa"/></Crd>{data.messages.slice().reverse().map(m=><div key={m.id} style={{padding:'11px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div style={{display:'flex',justifyContent:'space-between',marginBottom:'3px'}}><span style={{color:'#a78bfa',fontSize:'12px',fontWeight:'600'}}>{'тЖТ '+(m.to==='matkormi'?'рж╕ржХрж▓ ржорж╛ржаржХрж░рзНржорзА':m.to==='grahok'?'рж╕ржХрж▓ ржЧрзНрж░рж╛рж╣ржХ':'ржмрзНржпржХрзНрждрж┐ржЧржд')}</span><span style={{color:'#718096',fontSize:'11px'}}>{new Date(m.date).toLocaleString('bn-BD')}</span></div><div style={{color:'#fff',fontSize:'13px'}}>{m.text}</div></div>)}</div>}
{tab==='settings'&&<div><h2 style={{color:'#fff',marginBottom:'14px'}}>тЪЩ рж╕рзЗржЯрж┐ржВрж╕</h2><Crd sx={{marginBottom:'12px'}}><h3 style={{color:'#4f8ef7',fontSize:'14px',margin:'0 0 12px'}}>ЁЯСд ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржУ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб</h3><Inp label="ржирж╛ржо" value={form.apn!==undefined?form.apn:adm.name} onChange={e=>setForm({...form,apn:e.target.value})}/><Inp label="ржлрзЛржи ржиржорзНржмрж░" value={form.app!==undefined?form.app:adm.phone} onChange={e=>setForm({...form,app:e.target.value})}/><Inp label="ржирждрзБржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ ржХрж░рж▓рзЗ ржлрж╛ржБржХрж╛ рж░рж╛ржЦрзБржи" value={form.appw||''} onChange={e=>setForm({...form,appw:e.target.value})}/><Btn ch="ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЖржкржбрзЗржЯ ржХрж░рзБржи" onClick={saveAdminProf} color="#4f8ef7"/></Crd><Crd sx={{marginBottom:'12px'}}><h3 style={{color:'#48bb78',fontSize:'14px',margin:'0 0 12px'}}>ЁЯПж DPS ржкрзЗржорзЗржирзНржЯ рж╕рзЗржЯрж┐ржВ</h3><Inp label="ржкрзЗржорзЗржирзНржЯ ржиржорзНржмрж░" placeholder="01XXXXXXXXX" value={form.dpsNumber!==undefined?form.dpsNumber:(data.settings?.dpsNumber||'')} onChange={e=>setForm({...form,dpsNumber:e.target.value})}/><Slct label="ржорзЛржмрж╛ржЗрж▓ ржмрзНржпрж╛ржВржХрж┐ржВ" value={form.dpsApp!==undefined?form.dpsApp:(data.settings?.dpsApp||'ржмрж┐ржХрж╛рж╢')} onChange={e=>setForm({...form,dpsApp:e.target.value})}><option>ржмрж┐ржХрж╛рж╢</option><option>рж░ржХрзЗржЯ</option><option>ржиржЧржж</option></Slct><Slct label="ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐" value={form.dpsMethod!==undefined?form.dpsMethod:(data.settings?.dpsMethod||'sendMoney')} onChange={e=>setForm({...form,dpsMethod:e.target.value})}><option value="sendMoney">рж╕рзЗржирзНржб ржорж╛ржирж┐</option><option value="cashout">ржХрзНржпрж╛рж╢ ржЖржЙржЯ</option><option value="payment">ржкрзЗржорзЗржирзНржЯ (ржорж╛рж░рзНржЪрзЗржирзНржЯ)</option></Slct>{(form.dpsMethod||data.settings?.dpsMethod)==='payment'&&<Inp label="ржорж╛рж░рзНржЪрзЗржирзНржЯ ржиржорзНржмрж░" placeholder="ржорж╛рж░рзНржЪрзЗржирзНржЯ ржиржорзНржмрж░" value={form.dpsMerchantNumber!==undefined?form.dpsMerchantNumber:(data.settings?.dpsMerchantNumber||'')} onChange={e=>setForm({...form,dpsMerchantNumber:e.target.value})}/>}<Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={saveSt} color="#48bb78"/></Crd><Crd><h3 style={{color:'#f6ad55',fontSize:'14px',margin:'0 0 12px'}}>ЁЯТм ржпрзЛржЧрж╛ржпрзЛржЧ рж╕рзЗржЯрж┐ржВ</h3><Inp label="WhatsApp ржиржорзНржмрж░" placeholder="88017XXXXXXXX" value={form.whatsappNumber!==undefined?form.whatsappNumber:(data.settings?.whatsappNumber||'')} onChange={e=>setForm({...form,whatsappNumber:e.target.value})}/><Inp label="WhatsApp рж▓рж┐ржВржХ (ржРржЪрзНржЫрж┐ржХ)" placeholder="https://wa.me/..." value={form.whatsappLink!==undefined?form.whatsappLink:(data.settings?.whatsappLink||'')} onChange={e=>setForm({...form,whatsappLink:e.target.value})}/><Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={saveSt} color="#f6ad55"/></Crd></div>}
</div>
{md==='addMk'&&<Md title="ржирждрзБржи ржорж╛ржаржХрж░рзНржорзА" onClose={()=>setMd(null)}><PhotoPick value={form.photo} onChange={v=>setForm({...form,photo:v})}/><Inp label="ржирж╛ржо *" value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})}/><Inp label="ржлрзЛржи *" type="tel" value={form.phone||''} onChange={e=>setForm({...form,phone:e.target.value})}/><Inp label="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб *" type="password" value={form.pw||''} onChange={e=>setForm({...form,pw:e.target.value})}/><Inp label="ржПрж▓рж╛ржХрж╛" value={form.area||''} onChange={e=>setForm({...form,area:e.target.value})}/><Btn ch="ржпрзЛржЧ ржХрж░рзБржи" onClick={addMk} full/></Md>}
{md==='addG'&&<Md title="ржирждрзБржи ржЧрзНрж░рж╛рж╣ржХ" onClose={()=>setMd(null)}><PhotoPick value={form.photo} onChange={v=>setForm({...form,photo:v})}/><Inp label="ржирж╛ржо *" value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})}/><Inp label="ржлрзЛржи *" type="tel" value={form.phone||''} onChange={e=>setForm({...form,phone:e.target.value})}/><Inp label="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб *" type="password" value={form.pw||''} onChange={e=>setForm({...form,pw:e.target.value})}/><Slct label="ржорж╛ржаржХрж░рзНржорзА" value={form.mkId||''} onChange={e=>setForm({...form,mkId:e.target.value})}><option value="">-- ржирзЗржЗ --</option>{data.matkormi.map(m=><option key={m.id} value={m.id}>{m.name}</option>)}</Slct><Btn ch="ржпрзЛржЧ ржХрж░рзБржи" onClick={addG} full color="#48bb78"/></Md>}
{md==='sendMsg'&&<Md title="ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржи" onClose={()=>setMd(null)}><Slct label="ржкрзНрж░рж╛ржкржХ *" value={form.mto||''} onChange={e=>setForm({...form,mto:e.target.value})}><option value="">-- ржкрзНрж░рж╛ржкржХ ржмрзЗржЫрзЗ ржирж┐ржи --</option><option value="grahok">рж╕ржХрж▓ ржЧрзНрж░рж╛рж╣ржХ</option><option value="matkormi">рж╕ржХрж▓ ржорж╛ржаржХрж░рзНржорзА</option>{data.matkormi.map(m=><option key={m.id} value={m.id}>{m.name} (ржорж╛ржаржХрж░рзНржорзА)</option>)}{data.grahok.map(g=><option key={g.id} value={g.id}>{g.name} (ржЧрзНрж░рж╛рж╣ржХ)</option>)}</Slct><div style={{marginBottom:'12px'}}><label style={{display:'block',color:'#a0aec0',fontSize:'13px',marginBottom:'5px'}}>ржмрж╛рж░рзНрждрж╛ *</label><textarea value={form.mtxt||''} onChange={e=>setForm({...form,mtxt:e.target.value})} rows={4} placeholder="ржмрж╛рж░рзНрждрж╛ рж▓рж┐ржЦрзБржи..." style={{width:'100%',background:'rgba(255,255,255,0.07)',border:'1px solid rgba(255,255,255,0.15)',borderRadius:'10px',padding:'10px 14px',color:'#fff',fontSize:'14px',outline:'none',boxSizing:'border-box',resize:'vertical'}}/></div><Btn ch="ржкрж╛ржарж╛ржи" onClick={sendMsg} full color="#a78bfa"/></Md>}
</div>);}

function MatkormiPanel({data,saveData,currentUser,onLogout}){const[tab,setTab]=useState('grahok');const[form,setForm]=useState({});const[msg,setMsg]=useState('');const[locMsg,setLocMsg]=useState('');const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};const me=data.matkormi.find(m=>m.id===currentUser.id)||currentUser;const myG=data.grahok.filter(g=>g.matkormId===me.id);const combined=(parseFloat(form.savAmt||0)+parseFloat(form.loanAmt||0));const shareLocation=()=>{if(!navigator.geolocation){setLocMsg('GPS рж╕рж╛ржкрзЛрж░рзНржЯ ржирзЗржЗ');return;}navigator.geolocation.getCurrentPosition(pos=>{const loc={lat:pos.coords.latitude,lng:pos.coords.longitude,time:new Date().toISOString()};saveData({...data,matkormi:data.matkormi.map(m=>m.id===me.id?{...m,location:loc}:m)});setLocMsg('рж▓рзЛржХрзЗрж╢ржи рж╢рзЗржпрж╝рж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');setTimeout(()=>setLocMsg(''),3000);},()=>{setLocMsg('рж▓рзЛржХрзЗрж╢ржи ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐');});};const submitPayment=()=>{if(!form.gId||(!form.savAmt&&!form.loanAmt)||!form.kistiType)return;if(!form.gPhone){flash('ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ ржжрж┐ржи!');return;}const ps=[];if(parseFloat(form.savAmt||0)>0){ps.push({id:uid(),grahokId:form.gId,matkormId:me.id,amount:parseFloat(form.savAmt),kistiType:form.kistiType,type:'savings',grahokPhone:form.gPhone,note:form.note||'',date:new Date().toISOString(),status:'pending'});}if(parseFloat(form.loanAmt||0)>0){ps.push({id:uid(),grahokId:form.gId,matkormId:me.id,amount:parseFloat(form.loanAmt),kistiType:form.kistiType,type:'loan',grahokPhone:form.gPhone,note:form.note||'',date:new Date().toISOString(),status:'pending'});}saveData({...data,payments:[...data.payments,...ps]});setForm({});flash('ржкрзЗржорзЗржирзНржЯ ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ тЬУ (ржЕржирзБржорзЛржжржирзЗрж░ ржЕржкрзЗржХрзНрж╖рж╛ржпрж╝)');};const st=data.settings||{};return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{background:'linear-gradient(135deg,#1a3a2a,#0d2137)',padding:'13px 18px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}><div style={{display:'flex',alignItems:'center',gap:'10px'}}><Av name={me.name} photo={me.photo} size={38}/><div><div style={{color:'#fff',fontWeight:'700',fontSize:'15px'}}>{me.name}</div><div style={{color:'#68d391',fontSize:'11px'}}>ржорж╛ржаржХрж░рзНржорзА</div></div></div><div style={{display:'flex',alignItems:'center',gap:'8px'}}><LiveClock/>{st.whatsappNumber&&<a href={st.whatsappLink||'https://wa.me/'+st.whatsappNumber} target="_blank" rel="noreferrer" style={{background:'rgba(37,211,102,0.2)',borderRadius:'10px',padding:'7px 10px',fontSize:'15px',textDecoration:'none'}}>ЁЯТм</a>}<Bell userId={me.id} role="matkormi" data={data} saveData={saveData}/><button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button></div></div></div>{locMsg&&<div style={{background:'#2b4c3f',color:'#68d391',padding:'8px',textAlign:'center',fontSize:'13px'}}>{locMsg}</div>}<Flash msg={msg}/><div style={{display:'flex',background:'rgba(255,255,255,0.03)',borderBottom:'1px solid rgba(255,255,255,0.06)'}}>{[['grahok','ЁЯСе ржЧрзНрж░рж╛рж╣ржХ'],['submit','ЁЯТ│ ржкрзЗржорзЗржирзНржЯ ржЬржорж╛'],['history','ЁЯУЛ ржЗрждрж┐рж╣рж╛рж╕'],['loc','ЁЯУН рж▓рзЛржХрзЗрж╢ржи']].map(([v,l])=>(<button key={v} onClick={()=>setTab(v)} style={{flex:1,padding:'12px 6px',border:'none',background:'transparent',color:tab===v?'#48bb78':'#718096',borderBottom:tab===v?'2px solid #48bb78':'2px solid transparent',fontWeight:tab===v?'700':'500',cursor:'pointer',fontSize:'12px',whiteSpace:'nowrap',fontFamily:"'Hind Siliguri',sans-serif"}}>{l}</button>))}</div><div style={{padding:'16px',maxWidth:'600px',margin:'0 auto'}}>
{tab==='grahok'&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ржЖржорж╛рж░ ржЧрзНрж░рж╛рж╣ржХ ({myG.length})</h3>{myG.map(g=><Crd key={g.id} sx={{marginBottom:'9px'}}><div style={{display:'flex',alignItems:'center',gap:'11px'}}><Av name={g.name} photo={g.photo} size={44}/><div style={{flex:1}}><div style={{color:'#fff',fontWeight:'700'}}>{g.name}</div><div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {g.phone}</div></div><div style={{textAlign:'right'}}><div style={{color:'#48bb78',fontWeight:'700'}}>рз│{getSav(g.id,data).toLocaleString()}</div><div style={{color:'#f6ad55',fontSize:'12px'}}>ржЛржг: рз│{getLoan(g.id,data).toLocaleString()}</div></div></div></Crd>)}</div>}
{tab==='submit'&&<Crd><h3 style={{color:'#fff',margin:'0 0 14px'}}>ржкрзЗржорзЗржирзНржЯ ржЬржорж╛ ржжрж┐ржи</h3><Slct label="ржЧрзНрж░рж╛рж╣ржХ *" value={form.gId||''} onChange={e=>{const g=data.grahok.find(x=>x.id===e.target.value);setForm({...form,gId:e.target.value,gPhone:g?.phone||''});}}><option value="">-- ржЧрзНрж░рж╛рж╣ржХ ржмрзЗржЫрзЗ ржирж┐ржи --</option>{myG.map(g=><option key={g.id} value={g.id}>{g.name}</option>)}</Slct><Inp label="ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ *" type="tel" placeholder="ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ" value={form.gPhone||''} onChange={e=>setForm({...form,gPhone:e.target.value})} style={{borderColor:!form.gPhone?'rgba(252,129,129,0.5)':''}}/><Slct label="ржХрж┐рж╕рзНрждрж┐ ржзрж░ржи *" value={form.kistiType||''} onChange={e=>setForm({...form,kistiType:e.target.value})}><option value="">-- ржзрж░ржи --</option>{KISTI_TYPES.map(k=><option key={k} value={k}>{k}</option>)}</Slct>{form.gId&&<div style={{background:'rgba(255,255,255,0.04)',borderRadius:'10px',padding:'12px',marginBottom:'12px'}}><div style={{color:'#a0aec0',fontSize:'12px',marginBottom:'8px'}}>ржкрзЗржорзЗржирзНржЯрзЗрж░ ржкрж░рж┐ржорж╛ржг</div><div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'10px'}}><div><div style={{color:'#48bb78',fontSize:'12px',marginBottom:'4px'}}>ЁЯТЪ рж╕ржЮрзНржЪржпрж╝</div><input type="number" placeholder="рз│ ржкрж░рж┐ржорж╛ржг" value={form.savAmt||''} onChange={e=>setForm({...form,savAmt:e.target.value})} style={{width:'100%',background:'rgba(72,187,120,0.1)',border:'1px solid rgba(72,187,120,0.3)',borderRadius:'8px',padding:'8px 10px',color:'#fff',fontSize:'14px',outline:'none',boxSizing:'border-box'}}/></div><div><div style={{color:'#f6ad55',fontSize:'12px',marginBottom:'4px'}}>ЁЯТЫ ржЛржг ржкрж░рж┐рж╢рзЛржз</div><input type="number" placeholder="рз│ ржкрж░рж┐ржорж╛ржг" value={form.loanAmt||''} onChange={e=>setForm({...form,loanAmt:e.target.value})} style={{width:'100%',background:'rgba(246,173,85,0.1)',border:'1px solid rgba(246,173,85,0.3)',borderRadius:'8px',padding:'8px 10px',color:'#fff',fontSize:'14px',outline:'none',boxSizing:'border-box'}}/></div></div>{combined>0&&<div style={{marginTop:'10px',background:'rgba(255,255,255,0.08)',borderRadius:'8px',padding:'10px',textAlign:'center'}}><div style={{color:'#a0aec0',fontSize:'12px'}}>ржорзЛржЯ ржЖржжрж╛ржпрж╝</div><div style={{color:'#ecc94b',fontWeight:'800',fontSize:'22px'}}>рз│{combined.toLocaleString()}</div>{parseFloat(form.savAmt||0)>0&&<div style={{color:'#48bb78',fontSize:'12px'}}>рж╕ржЮрзНржЪржпрж╝: рз│{parseFloat(form.savAmt||0).toLocaleString()}</div>}{parseFloat(form.loanAmt||0)>0&&<div style={{color:'#f6ad55',fontSize:'12px'}}>ржЛржг: рз│{parseFloat(form.loanAmt||0).toLocaleString()}</div>}</div>}</div>}<Inp label="ржирзЛржЯ (ржРржЪрзНржЫрж┐ржХ)" placeholder="ржХрзЛржирзЛ ржоржирзНрждржмрзНржп" value={form.note||''} onChange={e=>setForm({...form,note:e.target.value})}/><Btn ch="ржкрзЗржорзЗржирзНржЯ ржЬржорж╛ ржжрж┐ржи тЬУ" onClick={submitPayment} full color="#48bb78"/><p style={{color:'#718096',fontSize:'12px',textAlign:'center',marginTop:'8px',marginBottom:0}}>тЪа ржЕрзНржпрж╛ржбржорж┐ржи ржЕржирзБржорзЛржжржирзЗрж░ ржкрж░ ржЪрзВржбрж╝рж╛ржирзНржд рж╣ржмрзЗ</p></Crd>}
{tab==='history'&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ржкрзЗржорзЗржирзНржЯ ржЗрждрж┐рж╣рж╛рж╕</h3>{data.payments.filter(p=>p.matkormId===me.id).slice().reverse().map(p=>{const g=data.grahok.find(x=>x.id===p.grahokId);const sc={pending:'#f6ad55',approved:'#48bb78',rejected:'#fc8181'};const sl={pending:'ржорзБрж▓рждрзБржмрж┐',approved:'тЬУ ржЕржирзБржорзЛржжрж┐ржд',rejected:'тЬХ ржмрж╛рждрж┐рж▓'};return(<Crd key={p.id} sx={{marginBottom:'8px'}}><div style={{display:'flex',justifyContent:'space-between'}}><div><div style={{color:'#fff',fontWeight:'600'}}>{g?.name}</div><div style={{color:'#718096',fontSize:'12px'}}>{p.type==='loan'?'ржЛржг':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType} тАв {new Date(p.date).toLocaleDateString('bn-BD')}</div></div><div style={{textAlign:'right'}}><div style={{color:'#ecc94b',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</div><div style={{color:sc[p.status],fontSize:'11px'}}>{sl[p.status]}</div></div></div></Crd>);})}</div>}
{tab==='loc'&&<Crd><h3 style={{color:'#fff',margin:'0 0 12px'}}>ЁЯУН рж▓рзЛржХрзЗрж╢ржи рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи</h3><p style={{color:'#a0aec0',fontSize:'13px',marginBottom:'14px',lineHeight:'1.6'}}>ржЕрзНржпрж╛ржбржорж┐ржи ржЖржкржирж╛рж░ ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи ржжрзЗржЦрждрзЗ ржкрж╛рж░ржмрзЗржиред</p>{me.location&&<div style={{background:'rgba(79,142,247,0.1)',borderRadius:'10px',padding:'11px',marginBottom:'13px'}}><div style={{color:'#a0aec0',fontSize:'12px'}}>рж╢рзЗрж╖ ржЖржкржбрзЗржЯ: {new Date(me.location.time).toLocaleString('bn-BD')}</div><a href={'https://maps.google.com/?q='+me.location.lat+','+me.location.lng} target="_blank" rel="noreferrer" style={{color:'#4f8ef7',fontSize:'13px'}}>ржЧрзБржЧрж▓ ржорзНржпрж╛ржкрзЗ ржжрзЗржЦрзБржи тЖТ</a></div>}<Btn ch="ЁЯУН ржмрж░рзНрждржорж╛ржи рж▓рзЛржХрзЗрж╢ржи рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи" onClick={shareLocation} full color="#4f8ef7"/></Crd>}
</div></div>);}

function GrahokPanel({data,saveData,currentUser,onLogout}){const[tab,setTab]=useState('home');const[dpsStep,setDpsStep]=useState(1);const[dpsF,setDpsF]=useState({});const[loanMd,setLoanMd]=useState(null);const[msg,setMsg]=useState('');const[locMsg,setLocMsg]=useState('');const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};const g=data.grahok.find(x=>x.id===currentUser.id)||currentUser;const sav=getSav(g.id,data);const loan=getLoan(g.id,data);const mk=data.matkormi.find(m=>m.id===g.matkormId);const myP=data.payments.filter(p=>p.grahokId===g.id);const myL=data.loans.filter(l=>l.grahokId===g.id);const myD=data.dps.filter(d=>d.grahokId===g.id);const actD=myD.filter(d=>d.status==='active');const pendD=myD.filter(d=>d.status==='pending');const st=data.settings||{};const tgtNum=st.dpsMethod==='payment'?(st.dpsMerchantNumber||st.dpsNumber||''):(st.dpsNumber||'');const methLabel={'sendMoney':'рж╕рзЗржирзНржб ржорж╛ржирж┐','cashout':'ржХрзНржпрж╛рж╢ ржЖржЙржЯ','payment':'ржкрзЗржорзЗржирзНржЯ (ржорж╛рж░рзНржЪрзЗржирзНржЯ)'}[st.dpsMethod||'sendMoney'];const sc={pending:'#f6ad55',approved:'#48bb78',rejected:'#fc8181'};const sl={pending:'ржорзБрж▓рждрзБржмрж┐',approved:'тЬУ ржЕржирзБржорзЛржжрж┐ржд',rejected:'тЬХ ржмрж╛рждрж┐рж▓'};const shareLocation=()=>{if(!navigator.geolocation){setLocMsg('GPS рж╕рж╛ржкрзЛрж░рзНржЯ ржирзЗржЗ');return;}navigator.geolocation.getCurrentPosition(pos=>{const loc={lat:pos.coords.latitude,lng:pos.coords.longitude,time:new Date().toISOString()};saveData({...data,grahok:data.grahok.map(x=>x.id===g.id?{...x,location:loc}:x)});setLocMsg('рж▓рзЛржХрзЗрж╢ржи рж╢рзЗржпрж╝рж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');setTimeout(()=>setLocMsg(''),3000);},()=>{setLocMsg('рж▓рзЛржХрзЗрж╢ржи ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐');});};const applyLoan=amount=>{const ex=myL.find(l=>l.status==='pending');if(ex){flash('ржПржХржЯрж┐ ржЖржмрзЗржжржи ржорзБрж▓рждрзБржмрж┐ ржЖржЫрзЗ');setLoanMd(null);return;}saveData({...data,loans:[...data.loans,{id:uid(),grahokId:g.id,amount,kistiType:loanMd?.kt||'ржорж╛рж╕рж┐ржХ',purpose:loanMd?.pur||'',date:new Date().toISOString(),status:'pending'}]});setLoanMd(null);flash('ржЛржг ржЖржмрзЗржжржи ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};const subDPS=()=>{if(!dpsF.txn||!dpsF.snd||!dpsF.app)return;saveData({...data,dps:[...data.dps,{id:uid(),grahokId:g.id,monthlyAmount:parseFloat(dpsF.ma),duration:parseInt(dpsF.dur),startDate:new Date().toISOString(),status:'pending',txnId:dpsF.txn,senderNumber:dpsF.snd,paymentApp:dpsF.app,paymentMethod:st.dpsMethod||'sendMoney'}]});setDpsStep(1);setDpsF({});setTab('home');flash('DPS ржЖржмрзЗржжржи ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');};return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/><div style={{background:'linear-gradient(135deg,#2a1a3a,#0d2137)',padding:'18px 18px 14px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}><div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'14px'}}><LiveClock/><div style={{display:'flex',gap:'8px',alignItems:'center'}}>{st.whatsappNumber&&<a href={st.whatsappLink||'https://wa.me/'+st.whatsappNumber} target="_blank" rel="noreferrer" style={{background:'rgba(37,211,102,0.2)',borderRadius:'10px',padding:'7px 10px',fontSize:'15px',textDecoration:'none'}}>ЁЯТм</a>}<Bell userId={g.id} role="grahok" data={data} saveData={saveData}/><button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button></div></div><div style={{display:'flex',flexDirection:'column',alignItems:'center',textAlign:'center'}}><Av name={g.name} photo={g.photo} size={72}/><div style={{color:'#fff',fontWeight:'800',fontSize:'19px',marginTop:'9px'}}>{g.name}</div><div style={{color:'#a78bfa',fontSize:'12px'}}>ржЧрзНрж░рж╛рж╣ржХ</div>{mk&&<div style={{color:'#718096',fontSize:'12px'}}>ржорж╛ржаржХрж░рзНржорзА: {mk.name}</div>}<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'10px',marginTop:'12px',width:'100%',maxWidth:'300px'}}><div style={{background:'rgba(72,187,120,0.12)',borderRadius:'12px',padding:'12px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржорзЛржЯ рж╕ржЮрзНржЪржпрж╝</div><div style={{color:'#48bb78',fontWeight:'800',fontSize:'21px'}}>рз│{sav.toLocaleString()}</div></div><div style={{background:'rgba(246,173,85,0.12)',borderRadius:'12px',padding:'12px'}}><div style={{color:'#a0aec0',fontSize:'11px'}}>ржорзЛржЯ ржЛржг</div><div style={{color:'#f6ad55',fontWeight:'800',fontSize:'21px'}}>рз│{loan.toLocaleString()}</div></div></div></div></div>{locMsg&&<div style={{background:'#2b4c3f',color:'#68d391',padding:'8px',textAlign:'center',fontSize:'13px'}}>{locMsg}</div>}<Flash msg={msg}/><div style={{display:'flex',background:'rgba(255,255,255,0.03)',borderBottom:'1px solid rgba(255,255,255,0.06)',overflowX:'auto'}}>{[['home','ЁЯПа рж╣рзЛржо'],['loan','ЁЯТ░ ржЛржг'],['dps','ЁЯПж DPS'],['history','ЁЯУЛ ржЗрждрж┐рж╣рж╛рж╕'],['loc','ЁЯУН рж▓рзЛржХрзЗрж╢ржи']].map(([v,l])=>(<button key={v} onClick={()=>{setTab(v);setDpsStep(1);}} style={{flex:1,padding:'11px 7px',border:'none',background:'transparent',color:tab===v?'#a78bfa':'#718096',borderBottom:tab===v?'2px solid #a78bfa':'2px solid transparent',fontWeight:tab===v?'700':'500',cursor:'pointer',fontSize:'12px',whiteSpace:'nowrap',fontFamily:"'Hind Siliguri',sans-serif"}}>{l}</button>))}</div><div style={{padding:'16px',maxWidth:'600px',margin:'0 auto'}}>
{tab==='home'&&<div><div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'11px',marginBottom:'13px'}}><Stat label="ржЕржирзБржорзЛржжрж┐ржд ржЬржорж╛" value={myP.filter(p=>p.status==='approved').length+'ржЯрж┐'} icon="тЬЕ" color="#48bb78"/><Stat label="ржЛржг ржирзЗржУржпрж╝рж╛" value={myL.filter(l=>l.status==='approved').length+'ржЯрж┐'} icon="ЁЯТ│" color="#f6ad55"/>{actD.length>0&&<Stat label="DPS ржорж╛рж╕рж┐ржХ" value={'рз│'+actD[0].monthlyAmount?.toLocaleString()} icon="ЁЯПж" color="#4f8ef7"/>}{pendD.length>0&&<Stat label="DPS ржорзБрж▓рждрзБржмрж┐" value={pendD.length+'ржЯрж┐'} icon="тП│" color="#f6ad55"/>}</div><div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'9px'}}><Btn ch="ЁЯТ░ ржЛржг ржЖржмрзЗржжржи" onClick={()=>setTab('loan')} color="#f6ad55" full/><Btn ch="ЁЯПж DPS" onClick={()=>setTab('dps')} color="#4f8ef7" full/></div></div>}
{tab==='loan'&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ржЛржг ржкрзНржпрж╛ржХрзЗржЬ</h3><div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'9px',marginBottom:'16px'}}>{LOAN_PACKAGES.map(p=><button key={p} onClick={()=>setLoanMd({amount:p})} style={{background:'rgba(246,173,85,0.1)',border:'1px solid rgba(246,173,85,0.3)',borderRadius:'11px',padding:'12px 6px',color:'#f6ad55',fontWeight:'700',cursor:'pointer',fontSize:'13px',fontFamily:"'Hind Siliguri',sans-serif"}}>{'рз│'+(p>=100000?'рзз,рзжрзж,рзжрзжрзж':p.toLocaleString())}</button>)}</div><h3 style={{color:'#fff',fontSize:'14px',marginBottom:'10px'}}>ржЛржгрзЗрж░ ржЗрждрж┐рж╣рж╛рж╕</h3>{myL.slice().reverse().map(l=><Crd key={l.id} sx={{marginBottom:'8px'}}><div style={{display:'flex',justifyContent:'space-between'}}><div><div style={{color:'#ecc94b',fontWeight:'800',fontSize:'17px'}}>рз│{l.amount.toLocaleString()}</div><div style={{color:'#718096',fontSize:'12px'}}>{l.kistiType} тАв {new Date(l.date).toLocaleDateString('bn-BD')}</div></div><span style={{color:sc[l.status],fontWeight:'600',fontSize:'12px'}}>{sl[l.status]}</span></div></Crd>)}</div>}
{tab==='dps'&&<div>{dpsStep===1&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ЁЯПж ржбрж┐ржкрж┐ржПрж╕ ржЖржмрзЗржжржи</h3>{actD.length>0?<Crd><div style={{textAlign:'center',padding:'10px'}}><div style={{fontSize:'30px',marginBottom:'8px'}}>ЁЯПж</div><div style={{color:'#4f8ef7',fontWeight:'800',fontSize:'21px'}}>рз│{actD[0].monthlyAmount?.toLocaleString()} / ржорж╛рж╕</div><div style={{color:'#718096',marginTop:'5px'}}>ржорзЗржпрж╝рж╛ржж: {actD[0].duration} ржорж╛рж╕</div><div style={{background:'rgba(79,142,247,0.1)',borderRadius:'8px',padding:'10px',marginTop:'11px'}}><div style={{color:'#a0aec0',fontSize:'12px'}}>ржорзЛржЯ ржЬржорж╛ рж╣ржмрзЗ</div><div style={{color:'#68d391',fontWeight:'800',fontSize:'19px'}}>рз│{(actD[0].monthlyAmount*actD[0].duration).toLocaleString()}</div></div></div></Crd>:pendD.length>0?<Crd><div style={{textAlign:'center',padding:'20px',color:'#f6ad55'}}>тП│ ржЖржкржирж╛рж░ DPS ржЖржмрзЗржжржи ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ</div></Crd>:<Crd><Inp label="ржорж╛рж╕рж┐ржХ ржкрж░рж┐ржорж╛ржг (рз│) *" type="number" placeholder="ржпрзЗржоржи: 500, 1000" value={dpsF.ma||''} onChange={e=>setDpsF({...dpsF,ma:e.target.value})}/><Slct label="ржорзЗржпрж╝рж╛ржж *" value={dpsF.dur||''} onChange={e=>setDpsF({...dpsF,dur:e.target.value})}><option value="">-- ржорзЗржпрж╝рж╛ржж --</option>{[12,24,36,48,60].map(d=><option key={d} value={d}>{d+' ржорж╛рж╕ ('+d/12+' ржмржЫрж░)'}</option>)}</Slct>{dpsF.ma&&dpsF.dur&&<div style={{background:'rgba(79,142,247,0.1)',borderRadius:'10px',padding:'11px',marginBottom:'12px',textAlign:'center'}}><div style={{color:'#a0aec0',fontSize:'12px'}}>ржорзЛржЯ ржЬржорж╛ рж╣ржмрзЗ</div><div style={{color:'#68d391',fontWeight:'800',fontSize:'20px'}}>рз│{(parseFloat(dpsF.ma||0)*parseInt(dpsF.dur||0)).toLocaleString()}</div></div>}<Btn ch="ржкрж░ржмрж░рзНрждрзА тЖТ" onClick={()=>{if(!dpsF.ma||!dpsF.dur)return;if(!st.dpsNumber&&!st.dpsMerchantNumber){flash('ржЕрзНржпрж╛ржбржорж┐ржи ржкрзЗржорзЗржирзНржЯ ржиржорзНржмрж░ рж╕рзЗржЯ ржХрж░рзЗржиржирж┐');return;}setDpsStep(2);}} full color="#4f8ef7" dis={!dpsF.ma||!dpsF.dur}/></Crd>}</div>}{dpsStep===2&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ЁЯТ│ ржкрзЗржорзЗржирзНржЯ ржХрж░рзБржи</h3><Crd sx={{marginBottom:'13px',border:'1px solid rgba(79,142,247,0.4)'}}><div style={{textAlign:'center',marginBottom:'14px'}}><div style={{fontSize:'34px',marginBottom:'6px'}}>{st.dpsApp==='ржмрж┐ржХрж╛рж╢'?'ЁЯТЪ':st.dpsApp==='рж░ржХрзЗржЯ'?'ЁЯЯг':'ЁЯФ╡'}</div><div style={{color:'#fff',fontWeight:'700',fontSize:'17px'}}>{st.dpsApp||'ржмрж┐ржХрж╛рж╢'}</div><div style={{color:'#a0aec0',fontSize:'12px'}}>{methLabel}</div></div><div style={{background:'rgba(255,255,255,0.08)',borderRadius:'11px',padding:'14px',textAlign:'center',marginBottom:'12px'}}><div style={{color:'#a0aec0',fontSize:'12px',marginBottom:'5px'}}>ржПржЗ ржиржорзНржмрж░рзЗ ржкрж╛ржарж╛ржи</div><div style={{color:'#4f8ef7',fontWeight:'800',fontSize:'24px',letterSpacing:'2px'}}>{tgtNum||'ржиржорзНржмрж░ рж╕рзЗржЯ рж╣ржпрж╝ржирж┐'}</div><div style={{color:'#ecc94b',fontWeight:'800',fontSize:'21px',marginTop:'9px'}}>рз│{parseFloat(dpsF.ma||0).toLocaleString()}</div></div><div style={{color:'#718096',fontSize:'13px',textAlign:'center'}}>{(st.dpsApp||'ржмрж┐ржХрж╛рж╢')+' рждрзЗ '}<strong style={{color:'#fff'}}>{methLabel}</strong>{' ржХрж░рзБржи'}</div></Crd><div style={{display:'flex',gap:'9px'}}><Btn ch="тЖР ржкрж┐ржЫржирзЗ" onClick={()=>setDpsStep(1)} outline color="#718096" sx={{flex:1}}/><Btn ch="ржЯрж╛ржХрж╛ ржкрж╛ржарж┐ржпрж╝рзЗржЫрж┐ тЖТ" onClick={()=>setDpsStep(3)} color="#48bb78" sx={{flex:2}}/></div></div>}{dpsStep===3&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>тЬЕ рждржерзНржп ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи</h3><Crd><Inp label="ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржЖржЗржбрж┐ *" placeholder="TxnID / рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржиржорзНржмрж░" value={dpsF.txn||''} onChange={e=>setDpsF({...dpsF,txn:e.target.value})}/><Inp label="ржкрж╛ржарж╛ржирзЛ ржиржорзНржмрж░ *" type="tel" placeholder="ржпрзЗ ржиржорзНржмрж░ ржерзЗржХрзЗ ржкрж╛ржарж┐ржпрж╝рзЗржЫрзЗржи" value={dpsF.snd||''} onChange={e=>setDpsF({...dpsF,snd:e.target.value})}/><Slct label="ржорзЛржмрж╛ржЗрж▓ ржмрзНржпрж╛ржВржХрж┐ржВ *" value={dpsF.app||''} onChange={e=>setDpsF({...dpsF,app:e.target.value})}><option value="">-- ржЕрзНржпрж╛ржк --</option><option>ржмрж┐ржХрж╛рж╢</option><option>рж░ржХрзЗржЯ</option><option>ржиржЧржж</option></Slct><div style={{background:'rgba(255,255,255,0.05)',borderRadius:'10px',padding:'11px',marginBottom:'12px'}}><div style={{color:'#fff',fontSize:'13px'}}>ржорж╛рж╕рж┐ржХ: рз│{parseFloat(dpsF.ma||0).toLocaleString()} ├Ч {dpsF.dur} ржорж╛рж╕</div><div style={{color:'#68d391',fontSize:'14px',fontWeight:'700'}}>ржорзЛржЯ: рз│{(parseFloat(dpsF.ma||0)*parseInt(dpsF.dur||0)).toLocaleString()}</div></div><Btn ch="ржЖржмрзЗржжржи ржЬржорж╛ ржжрж┐ржи тЬУ" onClick={subDPS} full color="#48bb78" dis={!dpsF.txn||!dpsF.snd||!dpsF.app}/><div style={{textAlign:'center',marginTop:'8px'}}><button onClick={()=>setDpsStep(2)} style={{background:'none',border:'none',color:'#718096',cursor:'pointer',fontSize:'12px'}}>тЖР ржкрзЗржорзЗржирзНржЯ ржкрзЗржЬрзЗ ржлрж┐рж░рзБржи</button></div></Crd></div>}</div>}
{tab==='history'&&<div><h3 style={{color:'#fff',marginBottom:'12px'}}>ржкрзЗржорзЗржирзНржЯ ржЗрждрж┐рж╣рж╛рж╕</h3>{myP.slice().reverse().map(p=><div key={p.id} style={{display:'flex',justifyContent:'space-between',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}><div><div style={{color:'#fff',fontWeight:'600'}}>{p.type==='loan'?'ржЛржг ржкрж░рж┐рж╢рзЛржз':'рж╕ржЮрзНржЪржпрж╝'} тАв {p.kistiType}</div><div style={{color:'#718096',fontSize:'12px'}}>{new Date(p.date).toLocaleDateString('bn-BD')}</div></div><div style={{textAlign:'right'}}><div style={{color:'#ecc94b',fontWeight:'700'}}>рз│{p.amount.toLocaleString()}</div><div style={{color:sc[p.status],fontSize:'11px'}}>{sl[p.status]}</div></div></div>)}</div>}
{tab==='loc'&&<Crd><h3 style={{color:'#fff',margin:'0 0 12px'}}>ЁЯУН ржЖржорж╛рж░ ржЕржмрж╕рзНржерж╛ржи</h3><p style={{color:'#a0aec0',fontSize:'13px',marginBottom:'14px',lineHeight:'1.6'}}>ржЖржкржирж╛рж░ ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи ржЕрзНржпрж╛ржбржорж┐ржиржХрзЗ ржЬрж╛ржирж╛ржиред</p>{g.location&&<div style={{background:'rgba(79,142,247,0.1)',borderRadius:'10px',padding:'11px',marginBottom:'13px'}}><div style={{color:'#a0aec0',fontSize:'12px'}}>рж╢рзЗрж╖ ржЖржкржбрзЗржЯ: {new Date(g.location.time).toLocaleString('bn-BD')}</div><a href={'https://maps.google.com/?q='+g.location.lat+','+g.location.lng} target="_blank" rel="noreferrer" style={{color:'#4f8ef7',fontSize:'13px'}}>ржЧрзБржЧрж▓ ржорзНржпрж╛ржкрзЗ ржжрзЗржЦрзБржи тЖТ</a></div>}<Btn ch="ЁЯУН рж▓рзЛржХрзЗрж╢ржи рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи" onClick={shareLocation} full color="#4f8ef7"/></Crd>}
</div>{loanMd&&<Md title="ржЛржг ржЖржмрзЗржжржи" onClose={()=>setLoanMd(null)}><div style={{textAlign:'center',marginBottom:'13px'}}><div style={{color:'#f6ad55',fontWeight:'800',fontSize:'26px'}}>рз│{loanMd.amount?.toLocaleString()}</div></div><Slct label="ржХрж┐рж╕рзНрждрж┐ ржкрж░рж┐ржХрж▓рзНржкржирж╛ *" value={loanMd.kt||''} onChange={e=>setLoanMd({...loanMd,kt:e.target.value})}><option value="">-- ржзрж░ржи --</option>{KISTI_TYPES.map(k=><option key={k} value={k}>{k+' ржХрж┐рж╕рзНрждрж┐'}</option>)}</Slct><Inp label="ржЙржжрзНржжрзЗрж╢рзНржп" placeholder="ржХрзА ржХрж╛ржЬрзЗ ржЛржг?" value={loanMd.pur||''} onChange={e=>setLoanMd({...loanMd,pur:e.target.value})}/><Btn ch="ржЖржмрзЗржжржи ржХрж░рзБржи" onClick={()=>applyLoan(loanMd.amount)} full color="#f6ad55"/></Md>}</div>);}

function _UnusedApp(){const[data,setData]=useState(null);const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[showAnn,setShowAnn]=useState(false);useEffect(()=>{(async()=>{try{const r=await window.storage.get('shomiti-v4');setData(r?JSON.parse(r.value):EMPTY);}catch(e){setData(EMPTY);}setLoading(false);})();},[]);const save=async nd=>{setData(nd);try{await window.storage.set('shomiti-v4',JSON.stringify(nd));}catch(e){}};const login=u=>{setUser(u);if(data?.announcement?.active&&data?.announcement?.text)setShowAnn(true);};if(loading)return(<div style={{minHeight:'100vh',background:'#0f1923',display:'flex',alignItems:'center',justifyContent:'center',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet"/><div style={{textAlign:'center',color:'#fff'}}><div style={{fontSize:'46px',marginBottom:'12px'}}>ЁЯПж</div><div>рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div></div></div>);if(!user)return <Login data={data} onLogin={login}/>;return(<>{showAnn&&<AnnouncePopup text={data.announcement.text} onClose={()=>setShowAnn(false)}/>}{user.role==='admin'&&<AdminPanel data={data} saveData={save} currentUser={data.users.find(u=>u.id==='admin1')||user} onLogout={()=>setUser(null)}/>}{user.role==='matkormi'&&<MatkormiPanel data={data} saveData={save} currentUser={user} onLogout={()=>setUser(null)}/>}{user.role==='grahok'&&<GrahokPanel data={data} saveData={save} currentUser={user} onLogout={()=>setUser(null)}/>}</>);}


// ============ SEARCH TAB COMPONENT ============
function SearchTab({data,saveData}){
  const[q,setQ]=useState('');
  const results=q.length>=2?data.grahok.filter(g=>
    (g.grahokId&&g.grahokId.toLowerCase().includes(q.toLowerCase()))||
    g.name.toLowerCase().includes(q.toLowerCase())||
    g.phone.includes(q)
  ):[];
  const sc={pending:'#f6ad55',approved:'#48bb78',rejected:'#fc8181'};
  return(<div>
    <h2 style={{color:'#fff',marginBottom:'14px'}}>ЁЯФН ржЧрзНрж░рж╛рж╣ржХ ржЦрзБржБржЬрзБржи</h2>
    <div style={{marginBottom:'16px'}}>
      <input 
        type="text" 
        placeholder="ржЧрзНрж░рж╛рж╣ржХ ржЖржЗржбрж┐ / ржирж╛ржо / ржлрзЛржи ржиржорзНржмрж░ рж▓рж┐ржЦрзБржи..."
        value={q}
        onChange={e=>setQ(e.target.value)}
        autoFocus
        style={{width:'100%',background:'rgba(255,255,255,0.09)',border:'2px solid rgba(79,142,247,0.5)',borderRadius:'12px',padding:'12px 16px',color:'#fff',fontSize:'15px',outline:'none',boxSizing:'border-box'}}
      />
    </div>
    {q.length>=2&&results.length===0&&<Crd><div style={{textAlign:'center',color:'#718096',padding:'20px'}}>ржХрзЛржирзЛ ржЧрзНрж░рж╛рж╣ржХ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐</div></Crd>}
    {results.map(g=>{
      const mk=data.matkormi.find(m=>m.id===g.matkormId);
      const sav=getSav(g.id,data);const loan=getLoan(g.id,data);
      const myP=data.payments.filter(p=>p.grahokId===g.id);
      return(<Crd key={g.id} sx={{marginBottom:'10px'}}>
        <div style={{display:'flex',alignItems:'center',gap:'11px',marginBottom:'10px'}}>
          <Av name={g.name} photo={g.photo} size={46}/>
          <div style={{flex:1}}>
            <div style={{color:'#fff',fontWeight:'800',fontSize:'15px'}}>{g.name}</div>
            {g.grahokId&&<div style={{color:'#a78bfa',fontSize:'13px',fontWeight:'700'}}>ЁЯЖФ {g.grahokId}</div>}
            <div style={{color:'#718096',fontSize:'12px'}}>ЁЯУ▒ {g.phone}</div>
            {mk&&<div style={{color:'#718096',fontSize:'12px'}}>ЁЯС╖ {mk.name}</div>}
          </div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'7px'}}>
          <div style={{background:'rgba(72,187,120,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}>
            <div style={{color:'#a0aec0',fontSize:'10px'}}>рж╕ржЮрзНржЪржпрж╝</div>
            <div style={{color:'#48bb78',fontWeight:'700',fontSize:'13px'}}>рз│{sav.toLocaleString()}</div>
          </div>
          <div style={{background:'rgba(246,173,85,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}>
            <div style={{color:'#a0aec0',fontSize:'10px'}}>ржЛржг</div>
            <div style={{color:'#f6ad55',fontWeight:'700',fontSize:'13px'}}>рз│{loan.toLocaleString()}</div>
          </div>
          <div style={{background:'rgba(79,142,247,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}>
            <div style={{color:'#a0aec0',fontSize:'10px'}}>рж▓рзЗржиржжрзЗржи</div>
            <div style={{color:'#4f8ef7',fontWeight:'700',fontSize:'13px'}}>{myP.length}ржЯрж┐</div>
          </div>
        </div>
        <div style={{marginTop:'10px',display:'flex',gap:'8px'}}>
          <div style={{flex:1,fontSize:'12px',color:'#718096'}}>
            рж╕рж░рзНржмрж╢рзЗрж╖: {myP.length>0?new Date(myP[myP.length-1].date).toLocaleDateString('bn-BD'):'ржХрзЛржирзЛ рж▓рзЗржиржжрзЗржи ржирзЗржЗ'}
          </div>
          <span style={{color:myP.filter(p=>p.status==='pending').length>0?'#f6ad55':'#718096',fontSize:'12px'}}>
            {myP.filter(p=>p.status==='pending').length>0?'тП│ ржорзБрж▓рждрзБржмрж┐ ржЖржЫрзЗ':'тЬУ рж╕ржм ржарж┐ржХ'}
          </span>
        </div>
      </Crd>);
    })}
    {q.length<2&&<div style={{textAlign:'center',padding:'30px',color:'#718096'}}>
      <div style={{fontSize:'40px',marginBottom:'10px'}}>ЁЯФН</div>
      <div>ржЧрзНрж░рж╛рж╣ржХ ржЖржЗржбрж┐, ржирж╛ржо ржмрж╛ ржлрзЛржи ржжрж┐ржпрж╝рзЗ ржЦрзБржБржЬрзБржи</div>
      <div style={{fontSize:'12px',marginTop:'6px'}}>ржХржоржкржХрзНрж╖рзЗ рзиржЯрж┐ ржЕржХрзНрж╖рж░ рж▓рж┐ржЦрзБржи</div>
    </div>}
  </div>);}


// ============ SUPER ADMIN & MULTI-TENANT SYSTEM ============

const SUPER_KEY = 'shomiti-super-v2';
const SUPER_DEFAULT = {phone:'01999999999',password:'super@123',samitis:[]};

function genSamitiId(){return 'SOM-'+String(Date.now()).slice(-5);}

function makeEmptySamiti(samitiId,samitiName,adminName,adminPhone,adminPassword){
  return {samitiId,samitiName,grahokCounter:0,
    users:[{id:'admin1',role:'admin',name:adminName,phone:adminPhone,password:adminPassword,photo:null}],
    matkormi:[],grahok:[],payments:[],loans:[],dps:[],messages:[],
    announcement:{text:'',active:false},
    settings:{dpsNumber:'',dpsApp:'ржмрж┐ржХрж╛рж╢',dpsMethod:'sendMoney',dpsMerchantNumber:'',whatsappNumber:'',whatsappLink:''}};
}

// ---- SamitiCard ----
function SamitiCard({samiti,onEnter,onResetPass,flash}){
  const[showReset,setShowReset]=useState(false);
  const[np,setNp]=useState('');
  return(<Crd sx={{marginBottom:'10px'}}>
    <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'10px'}}>
      <div>
        <div style={{color:'#fff',fontWeight:'800',fontSize:'15px'}}>{samiti.samitiName}</div>
        <div style={{color:'#a78bfa',fontSize:'12px',fontWeight:'700'}}>ЁЯЖФ {samiti.id}</div>
        <div style={{color:'#718096',fontSize:'12px'}}>ЁЯСд {samiti.adminName} тАв ЁЯУ▒ {samiti.phone}</div>
        <div style={{color:'#4a5568',fontSize:'11px'}}>ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб: {samiti.password}</div>
        <div style={{color:'#718096',fontSize:'11px'}}>{new Date(samiti.approvedAt||samiti.appliedAt).toLocaleDateString('bn-BD')}</div>
      </div>
      <span style={{color:'#48bb78',fontSize:'11px',background:'rgba(72,187,120,0.15)',padding:'3px 8px',borderRadius:'6px'}}>тЬЕ рж╕ржХрзНрж░рж┐ржпрж╝</span>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'7px',marginBottom:'10px'}}>
      <div style={{background:'rgba(79,142,247,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}><div style={{color:'#a0aec0',fontSize:'10px'}}>ржЧрзНрж░рж╛рж╣ржХ</div><div style={{color:'#4f8ef7',fontWeight:'700'}}>{samiti.totalGrahok||0}</div></div>
      <div style={{background:'rgba(72,187,120,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}><div style={{color:'#a0aec0',fontSize:'10px'}}>рж▓рзЗржиржжрзЗржи</div><div style={{color:'#48bb78',fontWeight:'700'}}>{samiti.totalTx||0}</div></div>
      <div style={{background:'rgba(246,173,85,0.1)',borderRadius:'8px',padding:'8px',textAlign:'center'}}><div style={{color:'#a0aec0',fontSize:'10px'}}>рж╕ржЮрзНржЪржпрж╝</div><div style={{color:'#f6ad55',fontWeight:'700',fontSize:'11px'}}>рз│{(samiti.totalSav||0).toLocaleString()}</div></div>
    </div>
    <div style={{display:'flex',gap:'8px'}}>
      <Btn ch="ЁЯСБ ржкрзНрж░ржмрзЗрж╢ ржХрж░рзБржи" onClick={onEnter} color="#a78bfa" sx={{flex:2}}/>
      <Btn ch="ЁЯФС" onClick={()=>setShowReset(!showReset)} outline color="#718096" sx={{flex:1}}/>
    </div>
    {showReset&&<div style={{marginTop:'10px'}}>
      <Inp label="ржирждрзБржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" value={np} onChange={e=>setNp(e.target.value)}/>
      <Btn ch="ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи" onClick={()=>{if(np){onResetPass(np);setNp('');setShowReset(false);}}} full color="#f6ad55"/>
    </div>}
  </Crd>);}

// ---- SuperAdminPanel ----
function SuperAdminPanel({superData,saveSuperData,onLogout}){
  const[tab,setTab]=useState('overview');
  const[form,setForm]=useState({});
  const[msg,setMsg]=useState('');
  const[controlSamiti,setControlSamiti]=useState(null);
  const flash=m=>{setMsg(m);setTimeout(()=>setMsg(''),3000);};
  const pending=superData.samitis.filter(s=>s.status==='pending');
  const approved=superData.samitis.filter(s=>s.status==='approved');

  const approve=async(id)=>{
    const s=superData.samitis.find(x=>x.id===id);
    const sd=makeEmptySamiti(id,s.samitiName,s.adminName,s.phone,s.password);
    // Firebase-ржП save ржХрж░рзБржи
    if(window.fbSaveSamiti){ await window.fbSaveSamiti(id, sd); }
    try{localStorage.setItem('shomiti-data-'+id,JSON.stringify(sd));}catch(e){}
    saveSuperData({...superData,samitis:superData.samitis.map(x=>x.id===id?{...x,status:'approved',approvedAt:new Date().toISOString()}:x)});
    flash('тЬУ рж╕ржорж┐рждрж┐ ржЕржирзБржорзЛржжржи рж╣ржпрж╝рзЗржЫрзЗ!');
  };
  const reject=(id)=>{saveSuperData({...superData,samitis:superData.samitis.map(x=>x.id===id?{...x,status:'rejected'}:x)});flash('ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ');};
  const resetPass=async(id,np)=>{
    saveSuperData({...superData,samitis:superData.samitis.map(x=>x.id===id?{...x,password:np}:x)});
    try{
      let sd = null;
      if(window.fbGetSamiti){ sd = await window.fbGetSamiti(id); }
      if(!sd){const raw=localStorage.getItem('shomiti-data-'+id);if(raw)sd=JSON.parse(raw);}
      if(sd){
        sd.users=sd.users.map(u=>u.id==='admin1'?{...u,password:np}:u);
        if(window.fbSaveSamiti){ await window.fbSaveSamiti(id, sd); }
        localStorage.setItem('shomiti-data-'+id,JSON.stringify(sd));
      }
    }catch(e){}
    flash('ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи рж╣ржпрж╝рзЗржЫрзЗ тЬУ');
  };
  const enterSamiti=async(s)=>{
    try{
      let sd = null;
      if(window.fbGetSamiti){ sd = await window.fbGetSamiti(s.id); }
      if(!sd){const raw=localStorage.getItem('shomiti-data-'+s.id);if(raw){sd=JSON.parse(raw);}}
      if(sd){setControlSamiti({info:s,data:sd});}
      else{flash('ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржпрж╝ржирж┐');}
    }catch(e){flash('ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржпрж╝ржирж┐');}
  };
  const syncStats=async()=>{
    const updated=await Promise.all(superData.samitis.map(async s=>{
      if(s.status!=='approved')return s;
      try{
        let sd = null;
        if(window.fbGetSamiti){ sd = await window.fbGetSamiti(s.id); }
        if(!sd){const raw=localStorage.getItem('shomiti-data-'+s.id);if(raw)sd=JSON.parse(raw);}
        if(sd){return{...s,totalGrahok:sd.grahok?.length||0,totalTx:sd.payments?.length||0,totalSav:sd.grahok?.reduce((acc,g)=>acc+(sd.payments?.filter(p=>p.grahokId===g.id&&p.status==='approved'&&p.type!=='loan').reduce((a,p)=>a+p.amount,0)||0),0)||0};}
      }catch(e){}
      return s;
    }));
    saveSuperData({...superData,samitis:updated});
    flash('рждржерзНржп ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ тЬУ');
  };

  if(controlSamiti){
    const saveControlData=async(nd)=>{
      if(window.fbSaveSamiti){ await window.fbSaveSamiti(controlSamiti.info.id, nd); }
      try{localStorage.setItem('shomiti-data-'+controlSamiti.info.id,JSON.stringify(nd));}catch(e){}
      setControlSamiti({...controlSamiti,data:nd});
    };
    return(<div>
      <div style={{background:'linear-gradient(90deg,#7c3aed,#4c1d95)',padding:'10px 16px',display:'flex',alignItems:'center',gap:'10px',position:'sticky',top:0,zIndex:100}}>
        <button onClick={()=>{setControlSamiti(null);syncStats();}} style={{background:'rgba(255,255,255,0.2)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 12px',cursor:'pointer',fontSize:'13px',fontFamily:"'Hind Siliguri',sans-serif"}}>тЖР рж╕рзБржкрж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи</button>
        <span style={{color:'#fff',fontSize:'13px',fontWeight:'600'}}>ЁЯСС ржирж┐ржпрж╝ржирзНрждрзНрж░ржг: {controlSamiti.info.samitiName}</span>
        <span style={{color:'#a78bfa',fontSize:'11px',marginLeft:'auto'}}>ЁЯЖФ {controlSamiti.info.id}</span>
      </div>
      <AdminPanel data={controlSamiti.data} saveData={saveControlData} currentUser={controlSamiti.data.users.find(u=>u.id==='admin1')} onLogout={()=>{setControlSamiti(null);syncStats();}}/>
    </div>);
  }

  const totalG=approved.reduce((s,x)=>s+(x.totalGrahok||0),0);
  const totalT=approved.reduce((s,x)=>s+(x.totalTx||0),0);
  const totalS=approved.reduce((s,x)=>s+(x.totalSav||0),0);

  return(<div style={{minHeight:'100vh',background:'#0f1923',fontFamily:"'Hind Siliguri',sans-serif"}}>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <div style={{background:'linear-gradient(135deg,#4c1d95,#1e1b4b)',padding:'13px 18px',borderBottom:'1px solid rgba(255,255,255,0.08)'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div style={{display:'flex',alignItems:'center',gap:'10px'}}>
          <div style={{fontSize:'28px'}}>ЁЯСС</div>
          <div><div style={{color:'#fff',fontWeight:'800',fontSize:'16px'}}>рж╕рзБржкрж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи</div><div style={{color:'#a78bfa',fontSize:'11px'}}>рж╕ржХрж▓ рж╕ржорж┐рждрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛</div></div>
        </div>
        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
          <LiveClock/>
          <Btn ch="ЁЯФД рж░рж┐ржлрзНрж░рзЗрж╢" onClick={syncStats} sm outline color="#a78bfa"/>
          <button onClick={onLogout} style={{background:'rgba(255,255,255,0.1)',border:'none',color:'#fff',borderRadius:'8px',padding:'6px 10px',cursor:'pointer',fontSize:'12px'}}>рж▓ржЧржЖржЙржЯ</button>
        </div>
      </div>
    </div>
    <Flash msg={msg}/>
    <div style={{display:'flex',background:'rgba(255,255,255,0.03)',borderBottom:'1px solid rgba(255,255,255,0.06)',overflowX:'auto'}}>
      {[['overview','ЁЯУК рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк'],['pending','тП│ ржЖржмрзЗржжржи'+(pending.length>0?' ('+pending.length+')':'')],['samitis','ЁЯПв рж╕ржорж┐рждрж┐рж╕ржорзВрж╣ ('+approved.length+')'],['settings','тЪЩ рж╕рзЗржЯрж┐ржВрж╕']].map(([v,l])=>(
        <button key={v} onClick={()=>setTab(v)} style={{flex:1,padding:'11px 6px',border:'none',background:'transparent',color:tab===v?'#a78bfa':'#718096',borderBottom:tab===v?'2px solid #a78bfa':'2px solid transparent',fontWeight:tab===v?'700':'500',cursor:'pointer',fontSize:'12px',whiteSpace:'nowrap',fontFamily:"'Hind Siliguri',sans-serif"}}>{l}</button>
      ))}
    </div>
    <div style={{padding:'16px',maxWidth:'700px',margin:'0 auto'}}>
      {tab==='overview'&&<div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'11px',marginBottom:'16px'}}>
          <Stat label="ржорзЛржЯ рж╕ржорж┐рждрж┐" value={approved.length} icon="ЁЯПв" color="#a78bfa"/>
          <Stat label="ржЕржирзБржорзЛржжржи ржмрж╛ржХрж┐" value={pending.length} icon="тП│" color="#fc8181"/>
          <Stat label="ржорзЛржЯ ржЧрзНрж░рж╛рж╣ржХ" value={totalG} icon="ЁЯСе" color="#48bb78"/>
          <Stat label="ржорзЛржЯ рж▓рзЗржиржжрзЗржи" value={totalT} icon="ЁЯТ│" color="#f6ad55"/>
        </div>
        <Crd sx={{marginBottom:'14px',background:'rgba(79,142,247,0.08)',border:'1px solid rgba(79,142,247,0.2)'}}>
          <div style={{color:'#a0aec0',fontSize:'12px',marginBottom:'4px'}}>рж╕ржХрж▓ рж╕ржорж┐рждрж┐рж░ ржорзЛржЯ рж╕ржЮрзНржЪржпрж╝</div>
          <div style={{color:'#48bb78',fontWeight:'800',fontSize:'28px'}}>рз│{totalS.toLocaleString()}</div>
        </Crd>
        {pending.length>0&&<Crd sx={{border:'1px solid rgba(252,129,129,0.3)'}}>
          <h3 style={{color:'#fc8181',margin:'0 0 12px',fontSize:'14px'}}>тЪа ржирждрзБржи ржЖржмрзЗржжржи ({pending.length}ржЯрж┐)</h3>
          {pending.slice(0,3).map(s=><div key={s.id} style={{padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,0.05)'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px'}}>
              <div><div style={{color:'#fff',fontWeight:'700'}}>{s.samitiName}</div><div style={{color:'#718096',fontSize:'12px'}}>{s.adminName} тАв {s.phone}</div></div>
              <div style={{display:'flex',gap:'6px'}}><Btn ch="тЬУ ржЕржирзБржорзЛржжржи" onClick={()=>approve(s.id)} sm color="#48bb78"/><Btn ch="тЬХ" onClick={()=>reject(s.id)} sm color="#fc8181"/></div>
            </div>
          </div>)}
          {pending.length>3&&<button onClick={()=>setTab('pending')} style={{color:'#a78bfa',background:'none',border:'none',cursor:'pointer',fontSize:'12px',marginTop:'8px',fontFamily:"'Hind Siliguri',sans-serif"}}>рж╕ржм ржжрзЗржЦрзБржи тЖТ</button>}
        </Crd>}
      </div>}

      {tab==='pending'&&<div>
        <h2 style={{color:'#fff',marginBottom:'14px'}}>рж╕ржорж┐рждрж┐ ржЖржмрзЗржжржирж╕ржорзВрж╣</h2>
        {pending.length===0?<Crd><div style={{textAlign:'center',color:'#718096',padding:'28px'}}>ржХрзЛржирзЛ ржорзБрж▓рждрзБржмрж┐ ржЖржмрзЗржжржи ржирзЗржЗ тЬУ</div></Crd>:
        pending.map(s=><Crd key={s.id} sx={{marginBottom:'10px',border:'1px solid rgba(246,173,85,0.3)'}}>
          <div style={{marginBottom:'12px'}}>
            <div style={{color:'#fff',fontWeight:'800',fontSize:'16px'}}>{s.samitiName}</div>
            <div style={{color:'#a78bfa',fontSize:'13px',fontWeight:'600'}}>рж╕ржорж┐рждрж┐ ржЖржЗржбрж┐: {s.id}</div>
            <div style={{color:'#718096',fontSize:'13px',marginTop:'4px'}}>ЁЯСд {s.adminName}</div>
            <div style={{color:'#718096',fontSize:'13px'}}>ЁЯУ▒ {s.phone}</div>
            <div style={{color:'#4a5568',fontSize:'11px'}}>ржЖржмрзЗржжржирзЗрж░ рж╕ржоржпрж╝: {new Date(s.appliedAt).toLocaleString('bn-BD')}</div>
          </div>
          <div style={{display:'flex',gap:'8px'}}>
            <Btn ch="тЬУ ржЕржирзБржорзЛржжржи ржХрж░рзБржи" onClick={()=>approve(s.id)} color="#48bb78" sx={{flex:1}}/>
            <Btn ch="тЬХ ржмрж╛рждрж┐рж▓" onClick={()=>reject(s.id)} color="#fc8181" sx={{flex:1}}/>
          </div>
        </Crd>)}
        {superData.samitis.filter(s=>s.status==='rejected').length>0&&<div style={{marginTop:'16px'}}>
          <h3 style={{color:'#718096',fontSize:'13px',marginBottom:'8px'}}>ржмрж╛рждрж┐рж▓ржХрзГржд ржЖржмрзЗржжржи</h3>
          {superData.samitis.filter(s=>s.status==='rejected').map(s=><div key={s.id} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,0.05)',display:'flex',justifyContent:'space-between'}}><span style={{color:'#718096',fontSize:'13px'}}>{s.samitiName} тАв {s.phone}</span><span style={{color:'#fc8181',fontSize:'12px'}}>ржмрж╛рждрж┐рж▓</span></div>)}
        </div>}
      </div>}

      {tab==='samitis'&&<div>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'14px'}}>
          <h2 style={{color:'#fff',margin:0}}>ржЕржирзБржорзЛржжрж┐ржд рж╕ржорж┐рждрж┐рж╕ржорзВрж╣</h2>
          <Btn ch="ЁЯФД рж░рж┐ржлрзНрж░рзЗрж╢" onClick={syncStats} sm outline color="#a78bfa"/>
        </div>
        {approved.length===0?<Crd><div style={{textAlign:'center',color:'#718096',padding:'28px'}}>ржПржЦржирзЛ ржХрзЛржирзЛ рж╕ржорж┐рждрж┐ ржЕржирзБржорзЛржжрж┐ржд рж╣ржпрж╝ржирж┐</div></Crd>:
        approved.map(s=><SamitiCard key={s.id} samiti={s} onEnter={()=>enterSamiti(s)} onResetPass={(np)=>resetPass(s.id,np)} flash={flash}/>)}
      </div>}

      {tab==='settings'&&<div>
        <h2 style={{color:'#fff',marginBottom:'14px'}}>тЪЩ рж╕рзБржкрж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи рж╕рзЗржЯрж┐ржВрж╕</h2>
        <Crd sx={{marginBottom:'14px'}}>
          <h3 style={{color:'#a78bfa',fontSize:'14px',margin:'0 0 12px'}}>ЁЯФР рж▓ржЧржЗржи рждржерзНржп ржкрж░рж┐ржмрж░рзНрждржи</h3>
          <Inp label="ржлрзЛржи ржиржорзНржмрж░" type="tel" value={form.phone!==undefined?form.phone:superData.phone} onChange={e=>setForm({...form,phone:e.target.value})}/>
          <Inp label="ржирждрзБржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ ржХрж░рж▓рзЗ ржлрж╛ржБржХрж╛ рж░рж╛ржЦрзБржи" value={form.pass||''} onChange={e=>setForm({...form,pass:e.target.value})}/>
          <Btn ch="рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи" onClick={()=>{saveSuperData({...superData,phone:form.phone||superData.phone,...(form.pass?{password:form.pass}:{})});setForm({});flash('рж╕ржВрж░ржХрзНрж╖ржг рж╣ржпрж╝рзЗржЫрзЗ тЬУ');}} full color="#a78bfa"/>
        </Crd>
        <Crd sx={{background:'rgba(79,142,247,0.05)',border:'1px solid rgba(79,142,247,0.2)'}}>
          <h3 style={{color:'#4f8ef7',fontSize:'14px',margin:'0 0 8px'}}>ЁЯУЛ ржмрж░рзНрждржорж╛ржи рж▓ржЧржЗржи рждржерзНржп</h3>
          <div style={{color:'#a0aec0',fontSize:'13px'}}>ржлрзЛржи: <strong style={{color:'#fff'}}>{superData.phone}</strong></div>
          <div style={{color:'#a0aec0',fontSize:'13px',marginTop:'4px'}}>ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб: <strong style={{color:'#fff'}}>{superData.password}</strong></div>
        </Crd>
      </div>}
    </div>
  </div>);}

// ---- SamitiApplyForm ----
function SamitiApplyForm({superData,saveSuperData,onBack}){
  const[form,setForm]=useState({});
  const[done,setDone]=useState(false);
  const[newId,setNewId]=useState('');
  const[err,setErr]=useState('');

  const submit=async()=>{
    if(!form.samitiName||!form.adminName||!form.phone||!form.password){setErr('рж╕ржм рждржерзНржп ржкрзВрж░ржг ржХрж░рзБржи');return;}
    const id=genSamitiId();
    const newSamiti={id,samitiName:form.samitiName,adminName:form.adminName,phone:form.phone,password:form.password,status:'pending',appliedAt:new Date().toISOString(),totalGrahok:0,totalTx:0,totalSav:0};
    const updated={...superData,samitis:[...superData.samitis,newSamiti]};
    // Firebase-ржП save ржХрж░рзБржи
    if(window.fbSaveSuper){ await window.fbSaveSuper(updated); }
    try{localStorage.setItem(SUPER_KEY,JSON.stringify(updated));}catch(e){}
    saveSuperData(updated);
    setNewId(id);setDone(true);
  };

  if(done)return(<div style={{minHeight:'100vh',background:'linear-gradient(135deg,#0f1923,#1a2d45)',display:'flex',alignItems:'center',justifyContent:'center',padding:'20px',fontFamily:"'Hind Siliguri',sans-serif"}}>
    <div style={{width:'100%',maxWidth:'380px',textAlign:'center'}}>
      <div style={{fontSize:'52px',marginBottom:'12px'}}>ЁЯОЙ</div>
      <h2 style={{color:'#fff',marginBottom:'8px'}}>ржЖржмрзЗржжржи ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ!</h2>
      <div style={{background:'rgba(167,139,250,0.15)',borderRadius:'14px',padding:'18px',marginBottom:'16px',border:'1px solid rgba(167,139,250,0.3)'}}>
        <div style={{color:'#a0aec0',fontSize:'12px',marginBottom:'6px'}}>ржЖржкржирж╛рж░ рж╕ржорж┐рждрж┐ ржЖржЗржбрж┐</div>
        <div style={{color:'#a78bfa',fontWeight:'800',fontSize:'26px',letterSpacing:'2px'}}>{newId}</div>
        <div style={{color:'#718096',fontSize:'12px',marginTop:'6px'}}>ржПржЗ ржЖржЗржбрж┐ рж╕рзНржХрзНрж░рж┐ржирж╢ржЯ ржирж┐ржпрж╝рзЗ рж░рж╛ржЦрзБржи</div>
      </div>
      <p style={{color:'#a0aec0',fontSize:'13px',marginBottom:'20px',lineHeight:'1.7'}}>ржЕржирзБржорзЛржжржи рж╣рж▓рзЗ ржЖржкржирж┐ рж▓ржЧржЗржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред<br/>ржлрзЛржи: <strong style={{color:'#fff'}}>{form.phone}</strong><br/>ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб: <strong style={{color:'#fff'}}>{form.password}</strong></p>
      <Btn ch="рж▓ржЧржЗржи ржкрзЗржЬрзЗ ржпрж╛ржи" onClick={onBack} full color="#4f8ef7"/>
    </div>
  </div>);

  return(<div style={{minHeight:'100vh',background:'linear-gradient(135deg,#0f1923,#1a2d45)',display:'flex',alignItems:'center',justifyContent:'center',padding:'20px',fontFamily:"'Hind Siliguri',sans-serif"}}>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <div style={{width:'100%',maxWidth:'380px'}}>
      <div style={{textAlign:'center',marginBottom:'20px'}}>
        <div style={{fontSize:'44px',marginBottom:'8px'}}>ЁЯПв</div>
        <h1 style={{color:'#fff',fontSize:'20px',fontWeight:'800',margin:'0 0 4px'}}>ржирждрзБржи рж╕ржорж┐рждрж┐ ржЦрзБрж▓рзБржи</h1>
        <p style={{color:'#718096',fontSize:'12px',margin:0}}>ржЖржмрзЗржжржи ржХрж░рзБржи тАФ ржЕржирзБржорзЛржжржирзЗрж░ ржкрж░ рж╢рзБрж░рзБ ржХрж░рзБржи</p>
      </div>
      <div style={{background:'rgba(255,255,255,0.05)',borderRadius:'18px',padding:'22px',border:'1px solid rgba(255,255,255,0.1)'}}>
        <Inp label="рж╕ржорж┐рждрж┐рж░ ржирж╛ржо *" placeholder="ржпрзЗржоржи: ржЖрж▓-ржЖржорж┐ржи рж╕ржорж┐рждрж┐" value={form.samitiName||''} onChange={e=>setForm({...form,samitiName:e.target.value})}/>
        <Inp label="ржЖржкржирж╛рж░ ржирж╛ржо *" placeholder="ржЕрзНржпрж╛ржбржорж┐ржирзЗрж░ ржкрзБрж░рзЛ ржирж╛ржо" value={form.adminName||''} onChange={e=>setForm({...form,adminName:e.target.value})}/>
        <Inp label="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ *" type="tel" placeholder="01XXXXXXXXX" value={form.phone||''} onChange={e=>setForm({...form,phone:e.target.value})}/>
        <Inp label="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржи *" type="password" placeholder="рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи" value={form.password||''} onChange={e=>setForm({...form,password:e.target.value})}/>
        {err&&<div style={{color:'#fc8181',fontSize:'13px',marginBottom:'10px',textAlign:'center'}}>{err}</div>}
        <Btn ch="ржЖржмрзЗржжржи ржЬржорж╛ ржжрж┐ржи тЖТ" onClick={submit} full color="#a78bfa" dis={!form.samitiName||!form.adminName||!form.phone||!form.password}/>
      </div>
      <div style={{textAlign:'center',marginTop:'14px'}}>
        <button onClick={onBack} style={{background:'none',border:'none',color:'#718096',cursor:'pointer',fontSize:'13px',fontFamily:"'Hind Siliguri',sans-serif"}}>тЖР рж▓ржЧржЗржи ржкрзЗржЬрзЗ ржлрж┐рж░рзБржи</button>
      </div>
    </div>
  </div>);}

// ---- Modified Login (replaces original) ----
function Login({superData,saveSuperData,onLogin,onApply}){
  const[phone,setPhone]=useState('');
  const[pass,setPass]=useState('');
  const[err,setErr]=useState('');
  const[role,setRole]=useState('superadmin');
  const[samitiId,setSamitiId]=useState('');
  const[samitiData,setSamitiData]=useState(null);
  const[loading,setLoading]=useState(false);

  const loadSamitiAndLogin=async(samiti,r)=>{
    setLoading(true);
    try{
      let sd = null;
      // Firebase ржерзЗржХрзЗ рж▓рзЛржб ржХрж░рзБржи
      if(window.fbGetSamiti){ sd = await window.fbGetSamiti(samiti.id); }
      // ржирж╛ ржкрзЗрж▓рзЗ localStorage ржЪрзЗржХ ржХрж░рзБржи
      if(!sd){
        const raw=localStorage.getItem('shomiti-data-'+samiti.id);
        if(raw) sd=JSON.parse(raw);
      }
      if(sd){
        if(r==='admin'){const u=sd.users.find(u=>u.role==='admin');if(u)return onLogin(u,sd,samiti.id);}
        if(r==='matkormi'){const u=sd.matkormi.find(m=>m.phone===phone&&m.password===pass);if(u)return onLogin({...u,role:'matkormi'},sd,samiti.id);}
        if(r==='grahok'){const u=sd.grahok.find(g=>g.phone===phone&&g.password===pass);if(u)return onLogin({...u,role:'grahok'},sd,samiti.id);}
      }
    }catch(e){}
    setLoading(false);
    setErr('ржлрзЛржи ржиржорзНржмрж░ ржмрж╛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрзБрж▓!');
  };

  const go=async()=>{
    setErr('');
    if(role==='superadmin'){
      if(phone===superData.phone&&pass===superData.password){return onLogin({role:'superadmin',name:'рж╕рзБржкрж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи'},null,null);}
      setErr('рж╕рзБржкрж╛рж░ ржЕрзНржпрж╛ржбржорж┐ржи рждржерзНржп ржнрзБрж▓!');return;
    }
    // For samiti roles, need samiti ID
    if(!samitiId){setErr('рж╕ржорж┐рждрж┐ ржЖржЗржбрж┐ ржжрж┐ржи');return;}
    const samiti=superData.samitis.find(s=>s.id===samitiId.toUpperCase()&&s.status==='approved');
    if(!samiti){setErr('рж╕ржорж┐рждрж┐ ржЖржЗржбрж┐ рж╕ржарж┐ржХ ржиржпрж╝ ржмрж╛ ржЕржирзБржорзЛржжрж┐ржд рж╣ржпрж╝ржирж┐');return;}
    if(role==='admin'){if(samiti.phone===phone&&samiti.password===pass){loadSamitiAndLogin(samiti,'admin');return;}setErr('ржлрзЛржи ржмрж╛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрзБрж▓!');return;}
    loadSamitiAndLogin(samiti,role);
  };

  return(<div style={{minHeight:'100vh',background:'linear-gradient(135deg,#0f1923 0%,#1a2d45 50%,#0d2137 100%)',display:'flex',alignItems:'center',justifyContent:'center',padding:'20px',fontFamily:"'Hind Siliguri',sans-serif"}}>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <div style={{width:'100%',maxWidth:'380px'}}>
      <div style={{textAlign:'center',marginBottom:'24px'}}>
        <div style={{fontSize:'52px',marginBottom:'8px'}}>ЁЯПж</div>
        <h1 style={{color:'#fff',fontSize:'24px',fontWeight:'800',margin:'0 0 4px'}}>рж╕ржорж┐рждрж┐ ржорзНржпрж╛ржирзЗржЬрж╛рж░</h1>
        <p style={{color:'#718096',margin:0,fontSize:'13px'}}>ржЖржкржирж╛рж░ рж╕ржорж┐рждрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзБржи</p>
      </div>
      <div style={{background:'rgba(255,255,255,0.05)',borderRadius:'18px',padding:'22px',border:'1px solid rgba(255,255,255,0.1)'}}>
        <div style={{display:'flex',gap:'4px',marginBottom:'16px',background:'rgba(0,0,0,0.2)',borderRadius:'10px',padding:'4px',flexWrap:'wrap'}}>
          {[['superadmin','ЁЯСС рж╕рзБржкрж╛рж░'],['admin','ЁЯПж ржЕрзНржпрж╛ржбржорж┐ржи'],['matkormi','ЁЯС╖ ржорж╛ржаржХрж░рзНржорзА'],['grahok','ЁЯСд ржЧрзНрж░рж╛рж╣ржХ']].map(([v,l])=>(
            <button key={v} onClick={()=>setRole(v)} style={{flex:1,padding:'7px 4px',borderRadius:'7px',border:'none',background:role===v?'#4f8ef7':'transparent',color:role===v?'#fff':'#718096',fontWeight:'600',cursor:'pointer',fontSize:'11px',fontFamily:"'Hind Siliguri',sans-serif",minWidth:'70px'}}>{l}</button>
          ))}
        </div>
        {role!=='superadmin'&&<Inp label="рж╕ржорж┐рждрж┐ ржЖржЗржбрж┐ *" placeholder="ржпрзЗржоржи: SOM-12345" value={samitiId} onChange={e=>setSamitiId(e.target.value)}/>}
        <Inp label="ржлрзЛржи ржиржорзНржмрж░" type="tel" placeholder="01XXXXXXXXX" value={phone} onChange={e=>setPhone(e.target.value)}/>
        <Inp label="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" type="password" placeholder="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи" value={pass} onChange={e=>setPass(e.target.value)} onKeyDown={e=>e.key==='Enter'&&go()}/>
        {err&&<div style={{color:'#fc8181',fontSize:'13px',marginBottom:'10px',textAlign:'center'}}>{err}</div>}
        <Btn ch={loading?'рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...':'рж▓ржЧржЗржи ржХрж░рзБржи'} onClick={go} full color="#4f8ef7" dis={loading}/>
        {role==='superadmin'&&<p style={{color:'#4a5568',fontSize:'11px',textAlign:'center',marginTop:'10px',marginBottom:0}}>ржбрж┐ржлрж▓рзНржЯ: 01999999999 / super@123</p>}
      </div>
      <div style={{textAlign:'center',marginTop:'16px'}}>
        <button onClick={onApply} style={{background:'rgba(167,139,250,0.15)',border:'1px solid rgba(167,139,250,0.4)',color:'#a78bfa',borderRadius:'12px',padding:'10px 20px',cursor:'pointer',fontSize:'13px',fontWeight:'600',fontFamily:"'Hind Siliguri',sans-serif"}}>ЁЯПв ржирждрзБржи рж╕ржорж┐рждрж┐ ржЦрзБрж▓рждрзЗ ржЖржмрзЗржжржи ржХрж░рзБржи</button>
      </div>
      <div style={{textAlign:'center',marginTop:'14px'}}><LiveClock/></div>
    </div>
  </div>);}

// ---- NEW App (replaces OriginalApp) ----
function App(){
  const[superData,setSuperData]=useState(null);
  const[samitiData,setSamitiData]=useState(null);
  const[samitiId,setSamitiId]=useState(null);
  const[user,setUser]=useState(null);
  const[loading,setLoading]=useState(true);
  const[showApply,setShowApply]=useState(false);
  const[showAnn,setShowAnn]=useState(false);

  useEffect(()=>{(async()=>{
    let sd;
    try{
      // Firebase ржерзЗржХрзЗ рж▓рзЛржб ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛
      if(window.fbGetSuper){
        sd = await window.fbGetSuper();
      }
      // Firebase-ржП ржирж╛ ржерж╛ржХрж▓рзЗ localStorage check ржХрж░рзБржи (ржкрзБрж░ржирзЛ data migration)
      if(!sd){
        const r=localStorage.getItem(SUPER_KEY);
        sd=r?JSON.parse(r):SUPER_DEFAULT;
        // ржкрзБрж░ржирзЛ data ржерж╛ржХрж▓рзЗ Firebase-ржП save ржХрж░рзБржи
        if(r && window.fbSaveSuper){ await window.fbSaveSuper(sd); }
      }
    }
    catch(e){sd=SUPER_DEFAULT;}
    setSuperData(sd);
    setLoading(false);
  })();},[]);

  const saveSuperData=async(nd)=>{
    setSuperData(nd);
    // Firebase-ржП save ржХрж░рзБржи
    if(window.fbSaveSuper){ await window.fbSaveSuper(nd); }
    // Backup рж╣рж┐рж╕рзЗржмрзЗ localStorage-ржПржУ рж░рж╛ржЦрзБржи
    try{localStorage.setItem(SUPER_KEY,JSON.stringify(nd));}catch(e){}
  };

  const saveSamitiData=async(nd)=>{
    setSamitiData(nd);
    if(samitiId){
      // Firebase-ржП save ржХрж░рзБржи
      if(window.fbSaveSamiti){ await window.fbSaveSamiti(samitiId, nd); }
      // Backup рж╣рж┐рж╕рзЗржмрзЗ localStorage-ржПржУ рж░рж╛ржЦрзБржи
      try{localStorage.setItem('shomiti-data-'+samitiId,JSON.stringify(nd));}catch(e){}
    }
  };

  const login=(u,sd,sid)=>{
    setUser(u);setSamitiData(sd);setSamitiId(sid);
    if(sd?.announcement?.active&&sd?.announcement?.text)setShowAnn(true);
  };

  if(loading)return(<div style={{minHeight:'100vh',background:'#0f1923',display:'flex',alignItems:'center',justifyContent:'center',fontFamily:"'Hind Siliguri',sans-serif"}}><link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet"/><div style={{textAlign:'center',color:'#fff'}}><div style={{fontSize:'46px',marginBottom:'12px'}}>ЁЯПж</div><div>рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div></div></div>);

  if(!superData)return null;

  if(showApply)return<SamitiApplyForm superData={superData} saveSuperData={saveSuperData} onBack={()=>setShowApply(false)}/>;

  if(!user)return<Login superData={superData} saveSuperData={saveSuperData} onLogin={login} onApply={()=>setShowApply(true)}/>;

  if(user.role==='superadmin')return<SuperAdminPanel superData={superData} saveSuperData={saveSuperData} onLogout={()=>setUser(null)}/>;

  if(!samitiData)return null;

  return(<>
    {showAnn&&<AnnouncePopup text={samitiData.announcement.text} onClose={()=>setShowAnn(false)}/>}
    {user.role==='admin'&&<AdminPanel data={samitiData} saveData={saveSamitiData} currentUser={samitiData.users.find(u=>u.id==='admin1')||user} onLogout={()=>setUser(null)}/>}
    {user.role==='matkormi'&&<MatkormiPanel data={samitiData} saveData={saveSamitiData} currentUser={user} onLogout={()=>setUser(null)}/>}
    {user.role==='grahok'&&<GrahokPanel data={samitiData} saveData={saveSamitiData} currentUser={user} onLogout={()=>setUser(null)}/>}
  </>);
}


const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
</script>
</body>
</html>